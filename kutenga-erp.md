ðŸš€ KUTENGA ERP

GestÃ£o completa para o seu negÃ³cio

Sistema de GestÃ£o Empresarial Modular Multi-Tenant construÃ­do com Laravel e React

ðŸ“‹ Ãndice

O Problema
A SoluÃ§Ã£o
CaracterÃ­sticas Principais
Arquitetura do Sistema
Stack TecnolÃ³gico
MÃ³dulos do Sistema
Multi-Tenancy
Estrutura do Banco de Dados
Estrutura de DiretÃ³rios
IntegraÃ§Ã£o entre MÃ³dulos
Dashboard e Interface
AutenticaÃ§Ã£o e PermissÃµes
API e Endpoints
InstalaÃ§Ã£o e ConfiguraÃ§Ã£o
Testes
Deploy
Roadmap
LicenÃ§a

ðŸ”´ O Problema
Realidade das Empresas MoÃ§ambicanas
As pequenas e mÃ©dias empresas em MoÃ§ambique enfrentam desafios crÃ­ticos na gestÃ£o dos seus negÃ³cios:

1. Sistemas Caros e InflexÃ­veis
   Problema Real:

- ERPs internacionais custam 50.000 - 200.000 MT/mÃªs
- Contratos de 1-3 anos (sem flexibilidade)
- Funcionalidades que nÃ£o usa mas paga na mesma
- Suporte tÃ©cnico caro e muitas vezes internacional

Impacto:
âŒ PMEs nÃ£o conseguem investir
âŒ Dinheiro desperdiÃ§ado em recursos nÃ£o utilizados
âŒ Sem escalabilidade conforme negÃ³cio cresce 2. Falta de Controlo do Estoque
SituaÃ§Ã£o TÃ­pica:

- Vendedor: "Temos este produto?"
- Gestor: "Deixa-me ir ver no armazÃ©m..."
- 15 minutos depois...
- Gestor: "NÃ£o, acabou ontem"
- Cliente frustrado sai da loja

ConsequÃªncias:
âŒ Perda de vendas
âŒ Ruptura de stock constante
âŒ Produtos vencidos no armazÃ©m
âŒ Capital parado em excesso de stock
âŒ Furtos nÃ£o detectados 3. GestÃ£o Financeira Desorganizada
CenÃ¡rio Real em Maputo:

- Cadernos com contas a receber
- Excel com contas a pagar
- Papel com controlo de caixa
- M-Pesa/E-Mola sem rastreamento
- Desconhecimento do lucro real

Resultado:
âŒ Clientes nÃ£o pagam (sem cobranÃ§a efetiva)
âŒ Fornecedores cobram juros (esqueceu vencimento)
âŒ Fluxo de caixa negativo (sem previsÃ£o)
âŒ DecisÃµes baseadas em "feeling" nÃ£o dados
âŒ Problemas com AT (documentaÃ§Ã£o inadequada) 4. Conformidade Fiscal Complexa
Desafio com Autoridade TributÃ¡ria:

- Faturas manuais (papel)
- NumeraÃ§Ã£o sequencial manual
- CÃ¡lculo de IVA propenso a erros
- Livro de vendas em papel
- RelatÃ³rios fiscais feitos em Excel

Riscos:
âŒ Multas da AT (numeraÃ§Ã£o incorreta)
âŒ Perda de tempo (horas fazendo relatÃ³rios)
âŒ Erros de cÃ¡lculo de impostos
âŒ Dificuldade em auditorias 5. Sistemas Desconectados
Realidade de Muitas Empresas:

- Vendas: Bloco de notas
- Estoque: Excel
- Financeiro: Caderno
- Clientes: Agenda telefÃ³nica
- Documentos: ArmÃ¡rio

Caos Operacional:
âŒ InformaÃ§Ã£o duplicada
âŒ Dados inconsistentes
âŒ Retrabalho constante
âŒ ImpossÃ­vel ter visÃ£o geral do negÃ³cio
âŒ DecisÃµes lentas e mal informadas 6. Acessibilidade e Conectividade
Contexto MoÃ§ambicano:

- Internet instÃ¡vel
- Energia elÃ©trica nÃ£o confiÃ¡vel
- Custo de dados mÃ³veis alto
- Necessidade de trabalhar offline

FrustraÃ§Ã£o:
âŒ Sistema para quando cai internet
âŒ Perda de dados durante cortes de luz
âŒ Custos altos de conectividade
âŒ ImpossÃ­vel trabalhar no campo/armazÃ©m

âœ… A SoluÃ§Ã£o
KUTENGA ERP: Sistema de GestÃ£o 100% MoÃ§ambicano
KUTENGA (do Cindau: "comprar/adquirir") Ã© um sistema ERP modular desenvolvido especificamente para as necessidades e realidade das empresas moÃ§ambicanas.
Por que KUTENGA Ã© Diferente?

1. ðŸ’° Modelo de PreÃ§o Justo e FlexÃ­vel
   Pague apenas pelo que usa:

MÃ³dulo Clientes (CRM) â†’ 800 USD setup + 200 USD/mÃªs
MÃ³dulo CatÃ¡logo â†’ 600 USD setup + 150 USD/mÃªs
MÃ³dulo Estoque â†’ 1.200 USD setup + 500 USD/mÃªs
MÃ³dulo Vendas (POS) â†’ 1.000 USD setup + 400 USD/mÃªs
MÃ³dulo FaturaÃ§Ã£o â†’ 1.500 USD setup + 350 USD/mÃªs
MÃ³dulo Financeiro â†’ 1.300 USD setup + 450 USD/mÃªs
MÃ³dulo RelatÃ³rio â†’

VANTAGENS:
âœ… Comece pequeno (1-2 mÃ³dulos)
âœ… CresÃ§a conforme o negÃ³cio
âœ… Sem compromissos de anos
âœ… Cancele quando quiser
âœ… 30 dias de garantia 2. ðŸ“¦ Controlo Total do Estoque
SoluÃ§Ã£o Real:

ANTES:
Cliente pergunta â†’ Ir ao armazÃ©m â†’ Verificar â†’ Responder
Tempo: 15 minutos | Resultado: Venda perdida (50% das vezes)

DEPOIS (com KUTENGA):
Cliente pergunta â†’ Consulta instantÃ¢nea â†’ Vende imediatamente
Tempo: 10 segundos | Resultado: Venda garantida

Funcionalidades:
âœ… Saldo em tempo real (todos os armazÃ©ns)
âœ… Alertas automÃ¡ticos (stock baixo)
âœ… Controlo de validade (produtos vencendo)
âœ… Rastreamento por lote e sÃ©rie
âœ… TransferÃªncias entre armazÃ©ns
âœ… InventÃ¡rio fÃ­sico digital
âœ… LocalizaÃ§Ã£o no armazÃ©m (Prateleira A1, etc.)
âœ… RelatÃ³rios gerenciais instantÃ¢neos 3. ðŸ’µ GestÃ£o Financeira Profissional
TransformaÃ§Ã£o Completa:

ANTES:
ðŸ““ Caderno â†’ â“ Quem deve? â†’ â° Venceu quando? â†’ ðŸ’¸ Perdeu dinheiro

DEPOIS:
ðŸ“± Sistema â†’ âœ… Dashboard claro â†’ ðŸ”” Alertas automÃ¡ticos â†’ ðŸ’° Recebe a tempo

Capacidades:
âœ… Contas a receber automÃ¡ticas
âœ… CobranÃ§as programadas (SMS/Email)
âœ… Contas a pagar com alertas
âœ… PrevisÃ£o de fluxo de caixa (30/60/90 dias)
âœ… IntegraÃ§Ã£o M-Pesa/E-Mola
âœ… RelatÃ³rios financeiros (DRE, BalanÃ§o)
âœ… AnÃ¡lise de inadimplÃªncia
âœ… Pagamentos parciais 4. ðŸ“„ Conformidade Fiscal AutomÃ¡tica
100% em Conformidade com AT:

AutomÃ¡tico:
âœ… NumeraÃ§Ã£o sequencial correta
âœ… CÃ¡lculo de IVA automÃ¡tico
âœ… QR Code fiscal
âœ… Hash de validaÃ§Ã£o
âœ… ATCUD (cÃ³digo AT)
âœ… SÃ©ries de documentos
âœ… Faturas, Recibos, Notas de CrÃ©dito

RelatÃ³rios Fiscais:
âœ… Livro de vendas (1 clique)
âœ… Resumo de IVA (automÃ¡tico)
âœ… ExportaÃ§Ã£o para AT (formato correto)

Resultado:
âœ… Zero multas
âœ… Auditorias tranquilas
âœ… Tempo economizado (horas â†’ minutos) 5. ðŸ”— Sistema Totalmente Integrado
Tudo Conectado:

Fluxo AutomÃ¡tico:
Venda Confirmada
â†“
â”œâ†’ Estoque atualizado automaticamente
â”œâ†’ Fatura gerada automaticamente
â”œâ†’ Conta a receber criada (se a prazo)
â”œâ†’ Cliente notificado (SMS/Email)
â””â†’ Dashboard atualizado em tempo real

BenefÃ­cios:
âœ… Zero retrabalho
âœ… Dados sempre consistentes
âœ… VisÃ£o 360Â° do negÃ³cio
âœ… DecisÃµes baseadas em dados reais
âœ… OperaÃ§Ã£o mais rÃ¡pida 6. ðŸ‡²ðŸ‡¿ Feito para MoÃ§ambique
CaracterÃ­sticas Locais:

Pagamentos:
âœ… M-Pesa integrado
âœ… E-Mola integrado
âœ… Dinheiro
âœ… CartÃ£o (Visa, Mastercard)
âœ… TransferÃªncia bancÃ¡ria
âœ… CrediÃ¡rio (a prazo)

Moeda:
âœ… Meticais (MZN)
âœ… FormataÃ§Ã£o local (1.000,00 MT)

Fiscalidade:
âœ… NUIT
âœ… IVA 16%
âœ… Documentos conforme AT
âœ… SÃ©ries fiscais moÃ§ambicanas

Idioma:
âœ… PortuguÃªs (MoÃ§ambique)
âœ… Termos locais
âœ… Suporte em portuguÃªs

Conectividade:
âœ… Otimizado para internet lenta
âœ… Funciona com conexÃµes instÃ¡veis
âœ… Cache inteligente
âœ… SincronizaÃ§Ã£o automÃ¡tica 7. ðŸ“± Interface Moderna e FÃ¡cil
ExperiÃªncia de UsuÃ¡rio:

Design:
âœ… Interface limpa (nÃ£o confusa)
âœ… Cores profissionais
âœ… Ãcones intuitivos
âœ… Dashboard com informaÃ§Ãµes claras

Acessibilidade:
âœ… Funciona em qualquer dispositivo
âœ… Computador (Windows, Mac, Linux)
âœ… Tablet
âœ… TelemÃ³vel (Android, iOS)
âœ… Responsivo (adapta Ã  tela)

Velocidade:
âœ… Carregamento rÃ¡pido
âœ… Pesquisas instantÃ¢neas
âœ… Filtros inteligentes
âœ… Atalhos de teclado 8. ðŸ›¡ï¸ SeguranÃ§a e Confiabilidade
Seus Dados Protegidos:

SeguranÃ§a:
âœ… Criptografia SSL
âœ… Backup diÃ¡rio automÃ¡tico
âœ… Seus dados sÃ£o SEUS (exportaÃ§Ã£o livre)
âœ… Multi-factor authentication (2FA)
âœ… Auditoria completa (quem fez o quÃª)
âœ… PermissÃµes granulares

Confiabilidade:
âœ… Uptime 99.5%
âœ… Servidores redundantes
âœ… Suporte tÃ©cnico em portuguÃªs
âœ… AtualizaÃ§Ãµes automÃ¡ticas
âœ… Monitoramento 24/7

ðŸŽ¯ Para Quem Ã© o KUTENGA?
âœ… Ideal Para:
Pequenas Empresas:

- Lojas (roupa, eletrÃ³nicos, farmÃ¡cia)
- Restaurantes e bares
- Oficinas (mecÃ¢nica, carpintaria)
- Prestadores de serviÃ§os
- Distribuidoras
- Grossistas

MÃ©dias Empresas:

- Supermercados
- Cadeias de lojas
- Empresas com mÃºltiplos armazÃ©ns
- Importadores/Exportadores
- IndÃºstrias

CaracterÃ­sticas Comuns:
âœ… Vendem produtos fÃ­sicos e/ou serviÃ§os
âœ… Precisam controlar estoque
âœ… TÃªm clientes a prazo
âœ… Querem crescer de forma organizada
âœ… Valorizam conformidade fiscal
âœ… Querem tomar decisÃµes baseadas em dados
âŒ NÃ£o Ã© Para:

- Empresas que sÃ³ precisam de contabilidade bÃ¡sica
- NegÃ³cios puramente digitais (sem produtos fÃ­sicos)
- Freelancers individuais
- Empresas satisfeitas com cadernos e Excel

âœ¨ CaracterÃ­sticas Principais
ðŸ¢ Multi-Tenant (SaaS)
Cada empresa completamente isolada:

empresa-abc.kutenga.co.mz â†’ Empresa ABC
empresa-xyz.kutenga.co.mz â†’ Empresa XYZ

BenefÃ­cios:
âœ… Dados 100% privados
âœ… CustomizaÃ§Ãµes independentes
âœ… MÃ³dulos diferentes por empresa
âœ… Backups individuais
âœ… MigraÃ§Ã£o de dados facilitada
ðŸ“¦ Modularidade Total
Contrate apenas o necessÃ¡rio:

Startup (Fase 1):
âœ“ CatÃ¡logo + Vendas
Custo: 1.600 USD setup + 550 USD/mÃªs

Crescimento (Fase 2):
âœ“ CatÃ¡logo + Vendas + Estoque
Custo: 2.800 USD setup + 1.050 USD/mÃªs

Consolidado (Fase 3):
âœ“ Todos os mÃ³dulos
Custo: 5.400 USD setup + 2.050 USD/mÃªs

Economia vs ERP tradicional:
ðŸ’° 70% mais barato
âš¡ ImplementaÃ§Ã£o 3x mais rÃ¡pida
ðŸ”— IntegraÃ§Ã£o Inteligente
MÃ³dulos conversam automaticamente:

Exemplo Real:

1. Vendedor confirma venda no POS
2. Sistema automaticamente:
   âœ“ DÃ¡ baixa no estoque
   âœ“ Gera fatura fiscal
   âœ“ Cria conta a receber (se a prazo)
   âœ“ Atualiza saldo do cliente
   âœ“ Notifica gestor (SMS)
   âœ“ Atualiza dashboard

Tempo: 2 segundos
Erros: Zero
âš¡ Performance Otimizada
RÃ¡pido mesmo com internet lenta:

Tecnologia:
âœ… Cache inteligente (Redis)
âœ… CompressÃ£o de dados
âœ… Lazy loading
âœ… Code splitting
âœ… CDN para assets
âœ… Database indexing

Resultado:
âš¡ Carrega em 1-2 segundos
âš¡ Pesquisas instantÃ¢neas
âš¡ Dashboard fluido
âš¡ Funciona com 2G/3G
ðŸ” SeguranÃ§a MÃ¡xima
ProteÃ§Ã£o em todas as camadas:

AplicaÃ§Ã£o:
âœ… AutenticaÃ§Ã£o multi-fator (2FA)
âœ… SessÃµes criptografadas
âœ… CSRF protection
âœ… SQL injection prevention
âœ… XSS protection

Dados:
âœ… Criptografia SSL/TLS
âœ… Backup diÃ¡rio automÃ¡tico
âœ… RetenÃ§Ã£o 90 dias
âœ… ExportaÃ§Ã£o livre dos dados

Acesso:
âœ… Roles e permissÃµes
âœ… Auditoria completa
âœ… Bloqueio por IP (opcional)
âœ… Logout automÃ¡tico

ðŸ—ï¸ Arquitetura do Sistema
VisÃ£o Geral
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND (SPA) â”‚
â”‚ React 18 + Inertia.js + TypeScript â”‚
â”‚ TailwindCSS + Headless UI â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ HTTP/JSON (Inertia Protocol)
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND (API) â”‚
â”‚ Laravel 11 â”‚
â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ APPLICATION LAYER â”‚ â”‚
â”‚ â”‚ Controllers | Requests | Resources â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ DOMAIN LAYER â”‚ â”‚
â”‚ â”‚ Services | Events | Listeners â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ DATA LAYER â”‚ â”‚
â”‚ â”‚ Models | Repositories â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INFRASTRUCTURE â”‚
â”‚ PostgreSQL | Redis | S3 | Queue â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
PadrÃµes Arquiteturais

1. Domain-Driven Design (DDD)
   Cada mÃ³dulo = Bounded Context independente

MÃ³dulos/
â”œâ”€â”€ Customers/ â†’ GestÃ£o de Clientes
â”œâ”€â”€ Catalog/ â†’ Produtos e ServiÃ§os
â”œâ”€â”€ Inventory/ â†’ Controlo de Estoque
â”œâ”€â”€ Sales/ â†’ Processo de Vendas
â”œâ”€â”€ Invoicing/ â†’ Documentos Fiscais
â””â”€â”€ Financial/ â†’ GestÃ£o Financeira
â””â”€â”€ RelatÃ³rio/ â†’ VisualizaÃ§Ã£o de RelatÃ³rio

BenefÃ­cios:
âœ… Complexidade gerenciÃ¡vel
âœ… Equipes podem trabalhar em paralelo
âœ… Testes isolados
âœ… Deploy independente (futuro) 2. Event-Driven Architecture
php// ComunicaÃ§Ã£o desacoplada via eventos

Exemplo:
Venda confirmada â†’ Event disparado
â†“
â”œâ†’ Listener: UpdateInventory (MÃ³dulo Estoque)
â”œâ†’ Listener: GenerateInvoice (MÃ³dulo FaturaÃ§Ã£o)
â””â†’ Listener: CreateReceivable (MÃ³dulo Financeiro)

Vantagem:
âœ… MÃ³dulos nÃ£o se conhecem diretamente
âœ… FÃ¡cil adicionar novos comportamentos
âœ… TestÃ¡vel individualmente 3. Repository Pattern
php// AbstraÃ§Ã£o de acesso a dados

Interface ProductRepository
â†“
â”œâ†’ EloquentProductRepository (PostgreSQL)
â”œâ†’ CachedProductRepository (Redis)
â””â†’ ApiProductRepository (External API)

Vantagem:
âœ… Troca de tecnologia sem afetar cÃ³digo
âœ… Testes com mocks
âœ… Cache transparente 4. Service Layer
php// LÃ³gica de negÃ³cio centralizada

Controllers (finos) â†’ Services (lÃ³gica) â†’ Repositories (dados)

Exemplo:
SalesController â†’ SalesService â†’ SaleRepository
â†“
StockValidator
PricingEngine
PaymentProcessor

Vantagem:
âœ… ReutilizaÃ§Ã£o de cÃ³digo
âœ… TestÃ¡vel
âœ… ManutenÃ­vel

ðŸ’» Stack TecnolÃ³gico
Backend
TecnologiaVersÃ£oPropÃ³sitoPor que escolhemosPHP8.3+Linguagem baseMaduro, performÃ¡tico, comunidadeLaravel11.xFramework principalProdutividade, ecossistema ricoPostgreSQL16.xBanco de dadosConfiÃ¡vel, ACID, JSON nativoRedis7.xCache e QueueRÃ¡pido, persistente, versÃ¡tilMeilisearch1.xSearch engineBusca rÃ¡pida, typo-tolerant
Frontend
TecnologiaVersÃ£oPropÃ³sitoPor que escolhemosReact18.xUI LibraryComponentizaÃ§Ã£o, performanceTypeScript5.xType safetyMenos bugs, melhor DXInertia.js1.xSPA adapterSPA sem complexidade de APITailwindCSS3.xStylingProdutividade, consistÃªnciaHeadless UI2.xComponentesAcessÃ­vel, unstyledRecharts2.xGrÃ¡ficosSimples, responsivo, bonito
DevOps & Infraestrutura
TecnologiaPropÃ³sitoDockerContainerizaÃ§Ã£o (desenvolvimento)GitHub ActionsCI/CDLaravel ForgeServer managementDigitalOceanHostingCloudflareCDN, DNS, DDoS protectionSentryError trackingUptime RobotMonitoring

ðŸ“¦ Pacotes Principais
Backend (Laravel)
json{
"require": {
"php": "^8.3",
"laravel/framework": "^11.0",
"inertiajs/inertia-laravel": "^1.0",

    // Multi-tenancy
    "stancl/tenancy": "^3.8",

    // AutenticaÃ§Ã£o
    "laravel/sanctum": "^4.0",
    "spatie/laravel-permission": "^6.0",

    // Auditoria
    "owen-it/laravel-auditing": "^13.0",

    // Search
    "laravel/scout": "^10.0",
    "meilisearch/meilisearch-php": "^1.0",

    // Jobs
    "laravel/horizon": "^5.0",

    // PDF
    "barryvdh/laravel-dompdf": "^3.0",

    // Excel
    "maatwebsite/excel": "^3.1",

    // Logging
    "sentry/sentry-laravel": "^4.0"

}
}
Frontend (NPM)
json{
"dependencies": {
"react": "^18.3.0",
"react-dom": "^18.3.0",
"@inertiajs/react": "^1.0.0",
"typescript": "^5.3.0",

    // UI
    "tailwindcss": "^3.4.0",
    "@headlessui/react": "^2.0.0",
    "@heroicons/react": "^2.0.0",

    // Forms
    "react-hook-form": "^7.50.0",
    "zod": "^3.22.0",

    // Data
    "@tanstack/react-query": "^5.0.0",
    "@tanstack/react-table": "^8.0.0",

    // State
    "zustand": "^4.5.0",

    // Charts
    "recharts": "^2.10.0",

    // Utils
    "date-fns": "^3.0.0",
    "clsx": "^2.1.0"

}
}

```

---

## ðŸ“¦ MÃ³dulos do Sistema

### **VisÃ£o Geral**

KUTENGA ERP Ã© composto por **6 mÃ³dulos principais**, cada um com funcionalidades especÃ­ficas mas totalmente integrados.
```

MÃ“DULOS DISPONÃVEIS:

1. ðŸ‘¥ CUSTOMERS â†’ GestÃ£o de Clientes (CRM)
2. ðŸ“š CATALOG â†’ CatÃ¡logo de Produtos e ServiÃ§os
3. ðŸ“¦ INVENTORY â†’ Controlo de Estoque
4. ðŸ’° SALES â†’ Vendas e Ponto de Venda (POS)
5. ðŸ“„ INVOICING â†’ FaturaÃ§Ã£o e Documentos Fiscais
6. ðŸ’µ FINANCIAL â†’ GestÃ£o Financeira
7. ðŸ“„ REPORT â†’ RelatÃ³rios

```

---

### **1. ðŸ‘¥ MÃ³dulo CUSTOMERS (CRM)**

**Objetivo:** Centralizar todos os dados e interaÃ§Ãµes com clientes.

#### **Funcionalidades**
```

Cadastro Completo:
âœ… Clientes pessoa fÃ­sica (PF) e jurÃ­dica (PJ)
âœ… NUIT e documentos fiscais
âœ… MÃºltiplos endereÃ§os (cobranÃ§a, entrega)
âœ… MÃºltiplos contactos por cliente
âœ… Email e telefone
âœ… CategorizaÃ§Ã£o (VIP, Normal, Ocasional)
âœ… Tags customizÃ¡veis

GestÃ£o Financeira:
âœ… Limite de crÃ©dito
âœ… Saldo devedor atual
âœ… HistÃ³rico de compras
âœ… AnÃ¡lise de inadimplÃªncia
âœ… Bloqueio automÃ¡tico (devedor)

Relacionamento:
âœ… Timeline de interaÃ§Ãµes
âœ… Notas e observaÃ§Ãµes
âœ… Anexos de documentos
âœ… HistÃ³rico de vendas
âœ… Campos personalizados

RelatÃ³rios:
âœ… Clientes mais ativos
âœ… AnÃ¡lise de inadimplÃªncia
âœ… Ticket mÃ©dio por cliente
âœ… Clientes inativos
Modelo de Dados
typescriptCustomer {
id: UUID
type: 'individual' | 'company'
code: string // CÃ³digo Ãºnico
name: string
trade_name?: string // Nome comercial
tax_id: string // NUIT
email?: string
phone?: string
status: 'active' | 'inactive' | 'blocked'
credit_limit?: number
current_balance: number // Saldo devedor
category_id?: UUID
tags: string[]
custom_fields: JSON

// Relacionamentos
addresses: Address[]
contacts: Contact[]
sales: Sale[]
receivables: AccountReceivable[]
}

```

#### **PreÃ§o**
```

Setup: 800 USD
Mensal: 200 USD

```

---

### **2. ðŸ“š MÃ³dulo CATALOG**

**Objetivo:** RepositÃ³rio central de produtos e serviÃ§os comercializados.

#### **Funcionalidades**
```

Produtos FÃ­sicos:
âœ… CÃ³digo SKU Ãºnico
âœ… CÃ³digo de barras
âœ… MÃºltiplas imagens
âœ… DimensÃµes e peso
âœ… Categorias hierÃ¡rquicas
âœ… Marca
âœ… Fornecedores
âœ… Flag "Controla Estoque" (sim/nÃ£o)
âœ… NÃ­veis mÃ­nimo/mÃ¡ximo
âœ… EspecificaÃ§Ãµes tÃ©cnicas

ServiÃ§os:
âœ… DuraÃ§Ã£o (minutos)
âœ… Requer agendamento
âœ… Profissionais necessÃ¡rios
âœ… SLA (tempo de resposta)

PrecificaÃ§Ã£o:
âœ… PreÃ§o de custo
âœ… PreÃ§o de venda
âœ… MÃºltiplas tabelas de preÃ§o
âœ… PreÃ§os por perÃ­odo
âœ… Margem calculada automaticamente

Impostos:
âœ… IVA configurÃ¡vel
âœ… Outros impostos
âœ… IsenÃ§Ãµes

VariaÃ§Ãµes:
âœ… Atributos (cor, tamanho, etc.)
âœ… VariaÃ§Ãµes com preÃ§os diferentes
âœ… SKU por variaÃ§Ã£o
Modelo de Dados
typescript// Classe base (abstrata)
Item {
id: UUID
type: 'product' | 'service'
code: string // SKU
barcode?: string
name: string
description?: string
category_id: UUID
brand_id?: UUID
status: 'active' | 'inactive'

// CRÃTICO para integraÃ§Ã£o com estoque
controls_inventory: boolean

// PreÃ§os
cost_price?: number
sale_price: number
prices: ItemPrice[] // Tabelas de preÃ§o

// Impostos
tax_config: JSON

// Imagens
images: string[]
primary_image?: string
}

// Produtos (extends Item)
Product {
...Item

// FÃ­sico
weight?: number
dimensions?: JSON

// Estoque
min_stock_level?: number
max_stock_level?: number
reorder_point?: number

// Fornecedores
suppliers: Supplier[]
}

// ServiÃ§os (extends Item)
Service {
...Item

// CaracterÃ­sticas
duration?: number // minutos
requires_scheduling: boolean
requires_professional: boolean
professional_types: string[]

// SLA
sla_response_time?: number
sla_completion_time?: number
}

```

#### **IntegraÃ§Ã£o**
```

CATALOG â†’ INVENTORY:

- Produtos com controls_inventory=true aparecem no estoque
- ServiÃ§os NÃƒO aparecem no estoque
- SincronizaÃ§Ã£o automÃ¡tica de dados

CATALOG â†’ SALES:

- CatÃ¡logo disponÃ­vel no POS
- PreÃ§os aplicados automaticamente
- ValidaÃ§Ã£o de estoque (se produto)

CATALOG â†’ FINANCIAL:

- Custos para anÃ¡lise de margem
- Categorias para relatÃ³rios

```

#### **PreÃ§o**
```

Setup: 600 USD
Mensal: 150 USD

```

---

### **3. ðŸ“¦ MÃ³dulo INVENTORY**

**Objetivo:** Controlo total de estoque de produtos fÃ­sicos.

> **NOTA:** Este mÃ³dulo pode funcionar de forma **standalone** (independente). Cliente pode contratar apenas Inventory se jÃ¡ tem sistema de vendas prÃ³prio.

#### **Funcionalidades**
```

ArmazÃ©ns:
âœ… MÃºltiplos armazÃ©ns/locais
âœ… ArmazÃ©m padrÃ£o
âœ… Tipos (fÃ­sico, virtual, trÃ¢nsito)
âœ… EndereÃ§o e responsÃ¡vel

MovimentaÃ§Ãµes:
âœ… Entrada (compra, devoluÃ§Ã£o)
âœ… SaÃ­da (venda, perda)
âœ… TransferÃªncia (entre armazÃ©ns)
âœ… Ajuste (correÃ§Ã£o)
âœ… Saldo inicial

Saldos em Tempo Real:
âœ… DisponÃ­vel para venda
âœ… Reservado (vendas pendentes)
âœ… Em trÃ¢nsito (transferÃªncias)
âœ… Total fÃ­sico

Rastreabilidade:
âœ… Por lote (manufacturing/expiration)
âœ… Por nÃºmero de sÃ©rie (individual)
âœ… LocalizaÃ§Ã£o fÃ­sica (Prateleira A1)
âœ… HistÃ³rico completo

InventÃ¡rio FÃ­sico:
âœ… Contagem programada
âœ… App mobile (contagem no local)
âœ… DivergÃªncias automÃ¡ticas
âœ… Ajustes com aprovaÃ§Ã£o
âœ… RelatÃ³rio de diferenÃ§as

Alertas Inteligentes:
âœ… Estoque abaixo do mÃ­nimo
âœ… Estoque acima do mÃ¡ximo
âœ… Produtos vencendo (30/60/90 dias)
âœ… Produtos sem movimento (estagnados)
âœ… Ruptura de stock

Custos:
âœ… Custo mÃ©dio ponderado
âœ… FIFO (primeiro a entrar, primeiro a sair)
âœ… LIFO (Ãºltimo a entrar, primeiro a sair)
âœ… Valor total do estoque

RelatÃ³rios:
âœ… Saldos por armazÃ©m
âœ… MovimentaÃ§Ãµes por perÃ­odo
âœ… Produtos mais/menos movimentados
âœ… Curva ABC
âœ… Acuracidade de estoque
âœ… Ruptura de stock (frequÃªncia)

```

#### **Modo Standalone**
```

Cliente tem sistema de vendas prÃ³prio, contrata sÃ³ Inventory:

OPÃ‡ÃƒO 1: Cadastro Interno BÃ¡sico

- Inventory tem tela simplificada de produtos
- Campos: CÃ³digo, Nome, Unidade
- Cliente cadastra diretamente

OPÃ‡ÃƒO 2: IntegraÃ§Ã£o via API

- Sistema externo sincroniza produtos:
  POST /api/inventory/products/sync
- Sistema externo envia movimentaÃ§Ãµes:
  POST /api/inventory/movements
- Inventory mantÃ©m saldos atualizados

Exemplo Real:
Distribuidora tem ERP antigo (sÃ³ vendas)
â†’ Contrata Inventory do KUTENGA
â†’ ERP envia movimentaÃ§Ãµes via API
â†’ Gestores consultam saldos no KUTENGA
Modelo de Dados
typescriptWarehouse {
id: UUID
code: string
name: string
type: 'physical' | 'virtual' | 'transit'
status: 'active' | 'inactive'
is_default: boolean
address?: string
manager_name?: string
phone?: string
allows_negative_stock: boolean
}

InventoryMovement {
id: UUID
product_id: UUID
warehouse_id: UUID

type: 'in' | 'out' | 'transfer'
reason: string
// 'purchase', 'sale', 'return', 'loss',
// 'transfer_in', 'transfer_out', etc.

quantity: number
unit_cost?: number

// Rastreabilidade
lot_id?: UUID
serial_number_id?: UUID
expiration_date?: date

// TransferÃªncia
source_warehouse_id?: UUID
destination_warehouse_id?: UUID
related_movement_id?: UUID

// LocalizaÃ§Ã£o
location?: string // "Prateleira A1"

// Origem
reference_type?: string // 'sale', 'purchase'
reference_id?: UUID

notes?: string
movement_date: timestamp
performed_by: UUID
}

InventoryBalance {
id: UUID
product_id: UUID
warehouse_id: UUID

quantity_available: number
quantity_reserved: number
quantity_in_transit: number
quantity_total: number // computed

average_cost: number
total_value: number // computed

last_movement_date: timestamp
updated_at: timestamp
}

Lot {
id: UUID
product_id: UUID
lot_number: string
manufacturing_date?: date
expiration_date?: date
receipt_date: date
initial_quantity: number
unit_cost: number
status: 'active' | 'expired' | 'blocked'
}

SerialNumber {
id: UUID
product_id: UUID
serial_number: string
lot_id?: UUID
status: 'in_stock' | 'sold' | 'reserved'
current_warehouse_id?: UUID
sold_at?: timestamp
warranty_ends_at?: date
}

PhysicalInventory {
id: UUID
inventory_number: string
type: 'full' | 'partial' | 'cycle'
warehouse_id: UUID
status: 'scheduled' | 'in_progress' | 'completed'

scheduled_date: date
start_date?: timestamp
end_date?: timestamp

responsible_users: UUID[]

items: PhysicalInventoryItem[]
}

PhysicalInventoryItem {
id: UUID
inventory_id: UUID
product_id: UUID

quantity_system: number // No sistema
quantity_counted?: number // Contado
quantity_difference: number // computed

counted: boolean
counted_at?: timestamp
counted_by?: UUID

adjusted: boolean
adjustment_id?: UUID
}

```

#### **IntegraÃ§Ã£o**
```

INVENTORY â† CATALOG:

- Produtos com controls_inventory=true sincronizam
- Dados mestres (nome, cÃ³digo) vÃªm do Catalog
- AtualizaÃ§Ã£o bidirecional

INVENTORY â† SALES:
Event: SaleConfirmed
â†’ Inventory dÃ¡ baixa automaticamente
â†’ SÃ³ para produtos (nÃ£o serviÃ§os)
â†’ Valida disponibilidade antes da venda

INVENTORY â†’ FINANCIAL:

- Valor total do estoque (balanÃ§o)
- Custo mÃ©dio (cÃ¡lculo de margem)
  API PÃºblica
  bash# Endpoints principais

# Produtos

POST /api/inventory/products/sync
GET /api/inventory/products/{code}

# MovimentaÃ§Ãµes

POST /api/inventory/movements
GET /api/inventory/movements?product_id=X

# Saldos

GET /api/inventory/balances
GET /api/inventory/balances/product/{id}
GET /api/inventory/balances/warehouse/{id}

# TransferÃªncias

POST /api/inventory/transfers

```

#### **PreÃ§o**
```

Setup: 1.200 USD
Mensal: 500 USD (atÃ© 10 armazÃ©ns)

```

---

### **4. ðŸ’° MÃ³dulo SALES**

**Objetivo:** Processar vendas de forma rÃ¡pida e eficiente.

#### **Funcionalidades**
```

Ponto de Venda (POS):
âœ… Interface rÃ¡pida e intuitiva
âœ… Busca de produtos (cÃ³digo, nome, barcode)
âœ… Carrinho de compras
âœ… Produtos + ServiÃ§os na mesma venda
âœ… ValidaÃ§Ã£o de estoque automÃ¡tica
âœ… CÃ¡lculo automÃ¡tico de valores
âœ… MÃºltiplas formas de pagamento
âœ… Pagamento misto (dinheiro + cartÃ£o)
âœ… Troco calculado automaticamente
âœ… ImpressÃ£o de recibo

CotaÃ§Ãµes/OrÃ§amentos:
âœ… CriaÃ§Ã£o rÃ¡pida
âœ… Validade configurÃ¡vel
âœ… ConversÃ£o em venda (1 clique)
âœ… HistÃ³rico de cotaÃ§Ãµes
âœ… Envio por email/WhatsApp

Vendas:
âœ… Vendas Ã  vista
âœ… Vendas a prazo (crediÃ¡rio)
âœ… Parcelamento
âœ… Desconto por item
âœ… Desconto global
âœ… Vendedor atribuÃ­do
âœ… ObservaÃ§Ãµes

Pagamentos:
âœ… Dinheiro
âœ… CartÃ£o (dÃ©bito/crÃ©dito)
âœ… M-Pesa
âœ… E-Mola
âœ… TransferÃªncia bancÃ¡ria
âœ… CrÃ©dito (a prazo)
âœ… Pagamentos parciais

DevoluÃ§Ãµes:
âœ… DevoluÃ§Ã£o total ou parcial
âœ… Produtos voltam ao estoque
âœ… Nota de crÃ©dito automÃ¡tica
âœ… Estorno financeiro

Cancelamentos:
âœ… Cancelamento com motivo
âœ… ReversÃ£o de estoque
âœ… Estorno financeiro
âœ… Auditoria completa

Controlo de Caixa:
âœ… Abertura de caixa (saldo inicial)
âœ… Sangrias (retiradas)
âœ… ReforÃ§os (adiÃ§Ãµes)
âœ… Fechamento de caixa
âœ… Quebra de caixa (diferenÃ§a)
âœ… RelatÃ³rio de caixa

RelatÃ³rios:
âœ… Vendas por perÃ­odo
âœ… Vendas por produto
âœ… Vendas por vendedor
âœ… Vendas por cliente
âœ… Produtos vs ServiÃ§os
âœ… Formas de pagamento
âœ… Ticket mÃ©dio
âœ… ConversÃ£o cotaÃ§Ã£o â†’ venda
Modelo de Dados
typescriptSale {
id: UUID
sale_number: string // NumeraÃ§Ã£o sequencial
series: string

// Cliente
customer_id: UUID
customer_snapshot: JSON // Dados no momento

// Tipo
type: 'sale' | 'quote' | 'order'
status: 'draft' | 'confirmed' | 'paid' | 'cancelled'

// Itens
items: SaleItem[]

// Valores
subtotal: number
discount_amount: number
tax_amount: number
total_amount: number

// Desconto global
global_discount?: JSON

// Pagamentos
payments: Payment[]
paid_amount: number
balance_due: number // Saldo restante

// ReferÃªncias
quote_id?: UUID
warehouse_id: UUID
seller_id?: UUID

// Datas
sale_date: timestamp
due_date?: date // Se a prazo

// Metadata
channel: 'pos' | 'online' | 'phone'
device_id?: string
notes?: string

created_by: UUID
}

SaleItem {
id: UUID
sale_id: UUID

// Item (produto ou serviÃ§o)
item_id: UUID
item_type: 'product' | 'service'
item_snapshot: JSON

quantity: number
unit_price: number
original_price: number
discount_amount: number
subtotal: number

// Impostos
tax_rate: number
tax_amount: number
total_amount: number

// Rastreabilidade (se produto)
lot_id?: UUID
serial_number?: string

// ServiÃ§o
scheduled_for?: timestamp
professional_id?: UUID

notes?: string
}

Payment {
id: UUID
sale_id: UUID

method: 'cash' | 'card' | 'mpesa' | 'emola' | 'transfer' | 'credit'

amount: number
received_amount?: number // Troco
change_amount?: number

// Detalhes
card_details?: JSON
mobile_money_details?: JSON

status: 'pending' | 'completed' | 'failed'
payment_date: timestamp
reference?: string
}

CashRegister {
id: UUID
code: string
name: string
warehouse_id: UUID
status: 'open' | 'closed'

opening_balance: number
opening_date: timestamp
opened_by: UUID

closing_balance?: number
closing_date?: timestamp
closed_by?: UUID

expected_balance?: number
difference?: number // Quebra
}
ValidaÃ§Ã£o Inteligente
typescript// Antes de confirmar venda

Para cada item no carrinho:

1. Buscar dados do produto/serviÃ§o
2. Se serviÃ§o â†’ OK (sempre disponÃ­vel)
3. Se produto:
   a. Verificar flag controls_inventory
   b. Se nÃ£o controla â†’ OK
   c. Se controla:
    - Buscar saldo no armazÃ©m
    - Validar quantidade disponÃ­vel
    - Se insuficiente â†’ ERRO

ValidaÃ§Ãµes adicionais:

- Cliente estÃ¡ bloqueado?
- Cliente excedeu limite de crÃ©dito?
- PreÃ§os estÃ£o atualizados?
- Impostos calculados corretamente?

```

#### **IntegraÃ§Ã£o**
```

SALES â†’ INVENTORY:
Event: SaleConfirmed
â†’ Para cada produto com controls_inventory=true:

- Criar movimentaÃ§Ã£o de saÃ­da
- Atualizar saldo
- Registrar lote/sÃ©rie (se houver)

SALES â†’ INVOICING:
Event: SaleConfirmed
â†’ Gerar documento fiscal automaticamente
â†’ Vincular invoice_id Ã  venda

SALES â†’ FINANCIAL:
Event: SaleConfirmed
â†’ Se Ã  vista: registrar entrada no caixa
â†’ Se a prazo: criar conta a receber

SALES â† CUSTOMERS:
â†’ Carregar dados do cliente
â†’ Validar limite de crÃ©dito
â†’ Verificar se estÃ¡ bloqueado

```

#### **PreÃ§o**
```

Setup: 1.000 USD
Mensal: 400 USD (atÃ© 5 terminais POS)

```

---

### **5. ðŸ“„ MÃ³dulo INVOICING**

**Objetivo:** Emitir documentos fiscais em conformidade com AT (Autoridade TributÃ¡ria).

#### **Funcionalidades**
```

Documentos Fiscais:
âœ… Faturas (FT)
âœ… Faturas-Recibo (FR)
âœ… Recibos (RC)
âœ… Notas de CrÃ©dito (NC)
âœ… Notas de DÃ©bito (ND)
âœ… Faturas Proforma (FP)

NumeraÃ§Ã£o:
âœ… SÃ©ries configurÃ¡veis
âœ… NumeraÃ§Ã£o sequencial automÃ¡tica
âœ… Zero falhas na sequÃªncia
âœ… MÃºltiplas sÃ©ries simultÃ¢neas

Conformidade AT:
âœ… QR Code fiscal
âœ… Hash de validaÃ§Ã£o
âœ… ATCUD (cÃ³digo AT)
âœ… Assinatura digital
âœ… Dados do emitente
âœ… Dados do adquirente
âœ… DiscriminaÃ§Ã£o de impostos

Impostos:
âœ… IVA 16% (configurÃ¡vel)
âœ… Outros impostos
âœ… IsenÃ§Ãµes
âœ… CÃ¡lculo automÃ¡tico
âœ… Base tributÃ¡vel

GeraÃ§Ã£o de PDF:
âœ… Template profissional
âœ… Logo da empresa
âœ… QR Code incluÃ­do
âœ… Todas as informaÃ§Ãµes fiscais
âœ… Download instantÃ¢neo

Envio AutomÃ¡tico:
âœ… Email com PDF anexo
âœ… WhatsApp (via link)
âœ… SMS com link
âœ… HistÃ³rico de envios

GestÃ£o:
âœ… Cancelamento (com motivo)
âœ… SubstituiÃ§Ã£o
âœ… Notas de crÃ©dito vinculadas
âœ… HistÃ³rico completo
âœ… ReimpressÃ£o

RelatÃ³rios Fiscais:
âœ… Livro de vendas
âœ… Resumo de IVA
âœ… Documentos por sÃ©rie
âœ… Documentos cancelados
âœ… ExportaÃ§Ã£o para AT
Modelo de Dados
typescriptInvoice {
id: UUID
sale_id?: UUID // Venda origem

// NumeraÃ§Ã£o
series: string // Ex: "FT"
number: string // Ex: "001"
full_number: string // Ex: "FT 2024/001"

// Tipo
document_type: 'invoice' | 'receipt' | 'credit_note' | 'debit_note' | 'proforma'

// Status
status: 'active' | 'cancelled' | 'replaced'
fiscal_status: 'pending' | 'validated' | 'rejected'

// Cliente
customer_id: UUID
customer_data: JSON // Snapshot

// Itens
items: InvoiceItem[]

// Valores
subtotal: number
discount_amount: number
tax_amount: number
total_amount: number

// Fiscal
fiscal_data: {
qr_code: string
hash_code: string
signature_code?: string
atcud: string
}

// Documento relacionado
related_invoice_id?: UUID

// Datas
issue_date: timestamp
due_date?: date
valid_until?: date

// PDF
pdf_url?: string
pdf_generated_at?: timestamp

// Envio
sent_at?: timestamp
sent_to?: string

// Cancelamento
cancelled_at?: timestamp
cancelled_by?: UUID
cancellation_reason?: string
replaced_by_invoice_id?: UUID
}

InvoiceItem {
id: UUID
invoice_id: UUID

item_code: string
item_name: string
description?: string

quantity: number
unit: string
unit_price: number
discount_amount: number
subtotal: number

tax_rate: number
tax_amount: number
total_amount: number
}

DocumentSeries {
id: UUID
code: string // "FT", "RC", "NC"
name: string
document_type: string
prefix?: string
current_number: number
padding: number // Zeros Ã  esquerda
status: 'active' | 'inactive'
}

TaxConfiguration {
id: UUID
name: string // "IVA 16%"
rate: number // 16.00
type: 'percentage' | 'fixed'
applies_to: 'products' | 'services' | 'both'
is_default: boolean
status: 'active' | 'inactive'
}

```

#### **Template de PDF**
```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [LOGO] EMPRESA XPTO, LDA â”‚
â”‚ NUIT: 123456789 â”‚
â”‚ Rua ABC, 123 - Maputo â”‚
â”‚ Tel: +258 84 123 4567 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚
â”‚ FATURA FT 2024/001 â”‚
â”‚ Data: 11/12/2024 Venc: 11/01/2025 â”‚
â”‚ â”‚
â”‚ Cliente: JoÃ£o Silva â”‚
â”‚ NUIT: 987654321 â”‚
â”‚ End: Av. 25 de Setembro, 456 - Maputo â”‚
â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚
â”‚ Item Qtd PreÃ§o IVA Total â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Computador Dell 1 40.000 6.400 46.400â”‚
â”‚ Mouse Logitech 2 800 256 1.856â”‚
â”‚ â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ Subtotal: 41.600â”‚
â”‚ IVA (16%): 6.656â”‚
â”‚ TOTAL: 48.256â”‚
â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚
â”‚ [QR CODE] Hash: ABC123DEF456 â”‚
â”‚ ATCUD: XYZ789 â”‚
â”‚ â”‚
â”‚ Processado por computador â”‚
â”‚ KUTENGA ERP - kutenga.co.mz â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

#### **IntegraÃ§Ã£o**
```

INVOICING â† SALES:
Event: SaleConfirmed
â†’ Gerar documento automÃ¡ticamente
â†’ Tipo baseado em configuraÃ§Ã£o
â†’ Dados da venda â†’ dados da fatura
â†’ Atribuir numeraÃ§Ã£o sequencial
â†’ Calcular impostos
â†’ Gerar QR Code e hash
â†’ Criar PDF
â†’ Vincular Ã  venda

INVOICING â†’ FINANCIAL:
Event: InvoiceGenerated
â†’ Se venda a prazo: criar conta a receber
â†’ Vincular documento fiscal

```

#### **PreÃ§o**
```

Setup: 1.500 USD
Mensal: 350 USD

```

---

### **6. ðŸ’µ MÃ³dulo FINANCIAL**

**Objetivo:** Controlar fluxo de caixa e gestÃ£o financeira completa.

#### **Funcionalidades**
```

Contas a Receber:
âœ… CriaÃ§Ã£o automÃ¡tica (vendas a prazo)
âœ… CriaÃ§Ã£o manual
âœ… Parcelamento
âœ… Vencimentos
âœ… Status (aberto, pago, vencido)
âœ… Dias em atraso
âœ… Juros e multas automÃ¡ticos
âœ… Pagamentos parciais
âœ… HistÃ³rico de recebimentos
âœ… Alertas de vencimento
âœ… GestÃ£o de cobranÃ§a
âœ… Bloqueio de clientes inadimplentes

Contas a Pagar:
âœ… Registro de despesas
âœ… Fornecedores
âœ… Categorias (salÃ¡rio, aluguel, etc.)
âœ… Centros de custo
âœ… Vencimentos
âœ… Status (aberto, pago, vencido)
âœ… ProgramaÃ§Ã£o de pagamentos
âœ… Pagamentos parciais
âœ… Alertas de vencimento

Fluxo de Caixa:
âœ… VisÃ£o consolidada (entradas/saÃ­das)
âœ… Saldo atual
âœ… ProjeÃ§Ã£o futura (30/60/90 dias)
âœ… GrÃ¡ficos de tendÃªncia
âœ… IdentificaÃ§Ã£o de perÃ­odos crÃ­ticos
âœ… AnÃ¡lise de sazonalidade
âœ… Receitas vs Despesas

Contas BancÃ¡rias:
âœ… MÃºltiplas contas
âœ… Saldo por conta
âœ… MovimentaÃ§Ãµes
âœ… ConciliaÃ§Ã£o bancÃ¡ria
âœ… ImportaÃ§Ã£o de extratos
âœ… TransferÃªncias entre contas

CategorizaÃ§Ã£o:
âœ… Categorias de receitas
âœ… Categorias de despesas
âœ… Hierarquia (pai/filho)
âœ… Centros de custo
âœ… OrÃ§amento por categoria

RelatÃ³rios Gerenciais:
âœ… DRE (DemonstraÃ§Ã£o do Resultado)
âœ… BalanÃ§o Patrimonial
âœ… Fluxo de Caixa (DFC)
âœ… Aging (contas a receber)
âœ… AnÃ¡lise de inadimplÃªncia
âœ… Receitas por categoria
âœ… Despesas por categoria
âœ… Comparativo mensal
âœ… ProjeÃ§Ãµes
Modelo de Dados
typescriptAccountReceivable {
id: UUID

// ReferÃªncias
customer_id: UUID
invoice_id?: UUID
sale_id?: UUID

// Valores
original_amount: number
paid_amount: number
balance_due: number

// Parcelas
installment_number?: number
total_installments?: number

// Datas
issue_date: date
due_date: date
paid_at?: timestamp

// Status
status: 'open' | 'partial' | 'paid' | 'overdue' | 'cancelled'
days_past_due?: number

// AcrÃ©scimos
interest_amount?: number
penalty_amount?: number

// Pagamentos
payments: ReceivablePayment[]

notes?: string
}

ReceivablePayment {
id: UUID
receivable_id: UUID

amount: number
payment_method: string
payment_date: timestamp
bank_account_id?: UUID

reference?: string
notes?: string

created_by: UUID
}

AccountPayable {
id: UUID

// Origem
supplier_id?: UUID
purchase_id?: UUID

// Tipo
type: 'purchase' | 'expense' | 'salary' | 'tax' | 'other'

// Valores
original_amount: number
paid_amount: number
balance_due: number

// Datas
issue_date: date
due_date: date
paid_at?: timestamp

// Status
status: 'open' | 'partial' | 'paid' | 'overdue' | 'cancelled'

// ClassificaÃ§Ã£o
expense_category_id: UUID
cost_center_id?: UUID

// Pagamentos
payments: PayablePayment[]

description: string
notes?: string
}

BankAccount {
id: UUID

bank_name: string
account_number: string
account_type: 'checking' | 'savings'

currency: string // MZN
current_balance: number

is_default: boolean
status: 'active' | 'inactive'
}

CashFlowEntry {
id: UUID

type: 'inflow' | 'outflow'
category: string

amount: number

transaction_date: date
effective_date: date

bank_account_id?: UUID

// ReferÃªncia
reference_type?: string
reference_id?: UUID

// ClassificaÃ§Ã£o
is_recurring: boolean
recurrence_pattern?: string

status: 'projected' | 'confirmed'

description: string
}

ExpenseCategory {
id: UUID

name: string
type: 'revenue' | 'expense'
parent_id?: UUID // HierÃ¡rquico

budget_amount?: number

status: 'active' | 'inactive'
}

CostCenter {
id: UUID

code: string
name: string
description?: string

status: 'active' | 'inactive'
}

```

#### **Dashboard Financeiro**
```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DASHBOARD FINANCEIRO â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ A RECEBER â”‚ â”‚ A PAGAR â”‚ â”‚ SALDO â”‚â”‚
â”‚ â”‚ 150.000 MT â”‚ â”‚ 45.000 MT â”‚ â”‚105k MT â”‚â”‚
â”‚ â”‚ 12 contas â”‚ â”‚ 5 contas â”‚ â”‚ â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚ â”‚
â”‚ FLUXO DE CAIXA (PrÃ³ximos 90 dias) â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [GrÃ¡fico de barras] â”‚ â”‚
â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆ Entradas â”‚ â”‚
â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆ SaÃ­das â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚
â”‚ âš ï¸ ALERTAS â”‚
â”‚ â€¢ 3 contas vencidas (15.000 MT) â”‚
â”‚ â€¢ 5 contas vencem esta semana â”‚
â”‚ â€¢ Fluxo negativo previsto para Jan â”‚
â”‚ â”‚
â”‚ CONTAS VENCIDAS (Top 5) â”‚
â”‚ 1. JoÃ£o Silva - 8.500 MT (15 dias) â”‚
â”‚ 2. Maria Santos - 4.200 MT (8 dias) â”‚
â”‚ 3. Pedro Costa - 2.300 MT (3 dias) â”‚
â”‚ ... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

#### **IntegraÃ§Ã£o**
```

FINANCIAL â† SALES:
Event: SaleConfirmed
â†’ Se Ã  vista: registrar entrada no caixa
â†’ Se a prazo: criar conta a receber
â†’ Atualizar fluxo de caixa

FINANCIAL â† INVOICING:
â†’ Vincular documento fiscal
â†’ Dados fiscais disponÃ­veis

FINANCIAL â†’ CUSTOMERS:
â†’ Atualizar saldo devedor
â†’ Bloquear se inadimplente
â†’ Liberar quando pagar

```

#### **CobranÃ§a AutomÃ¡tica**
```

Sistema monitora diariamente:

7 dias antes do vencimento:
â†’ Email/SMS: "Lembrete: fatura vence em 7 dias"

No dia do vencimento:
â†’ Email/SMS: "Fatura vence hoje"

1 dia apÃ³s vencimento:
â†’ Email/SMS: "Fatura vencida - juros aplicados"
â†’ Aplicar juros (configurÃ¡vel)

3 dias apÃ³s vencimento:
â†’ Email/SMS: "2Âª cobranÃ§a"

7 dias apÃ³s vencimento:
â†’ Email/SMS: "3Âª cobranÃ§a - conta serÃ¡ bloqueada"

15 dias apÃ³s vencimento:
â†’ Bloquear cliente (sem novas vendas a prazo)
â†’ Notificar gestor

```

#### **PreÃ§o**
```

Setup: 1.300 USD
Mensal: 450 USD

```

---

## ðŸ¢ Multi-Tenancy

### **Conceito**

KUTENGA ERP Ã© **100% multi-tenant** (SaaS), permitindo que mÃºltiplas empresas usem o mesmo sistema com dados completamente isolados.

### **EstratÃ©gia: Schema Separation**
```

PostgreSQL Database: kutenga_erp

â”œâ”€ Schema: public (tabelas globais)
â”‚ â”œâ”€ tenants
â”‚ â”œâ”€ users (globais)
â”‚ â”œâ”€ subscriptions
â”‚ â””â”€ system_config
â”‚
â”œâ”€ Schema: tenant_abc (Empresa ABC)
â”‚ â”œâ”€ customers
â”‚ â”œâ”€ products
â”‚ â”œâ”€ warehouses
â”‚ â”œâ”€ inventory_movements
â”‚ â”œâ”€ sales
â”‚ â”œâ”€ invoices
â”‚ â”œâ”€ accounts_receivable
â”‚ â””â”€ ... (todas as tabelas de negÃ³cio)
â”‚
â”œâ”€ Schema: tenant_xyz (Empresa XYZ)
â”‚ â”œâ”€ customers
â”‚ â”œâ”€ products
â”‚ â””â”€ ... (cÃ³pia completa das tabelas)
â”‚
â””â”€ Schema: tenant_demo (Empresa Demo)
â””â”€ ...

VANTAGENS:
âœ… Isolamento total (seguranÃ§a mÃ¡xima)
âœ… Backup individual por empresa
âœ… Performance (Ã­ndices separados)
âœ… MigraÃ§Ã£o de dados facilitada
âœ… CustomizaÃ§Ã£o por tenant
âœ… Troubleshooting simplificado

```

### **IdentificaÃ§Ã£o do Tenant**
```

OpÃ§Ãµes de Acesso:

OPÃ‡ÃƒO 1: SubdomÃ­nio (Implementado)
empresa-abc.kutenga.co.mz â†’ Tenant ABC
empresa-xyz.kutenga.co.mz â†’ Tenant XYZ
demo.kutenga.co.mz â†’ Tenant Demo

OPÃ‡ÃƒO 2: Path (Alternativa)
kutenga.co.mz/abc â†’ Tenant ABC
kutenga.co.mz/xyz â†’ Tenant XYZ

OPÃ‡ÃƒO 3: Token (API)
Authorization: Bearer {token_com_tenant_info}

```

### **Fluxo de RequisiÃ§Ã£o**
```

1. RequisiÃ§Ã£o chega:
   GET https://empresa-abc.kutenga.co.mz/api/products
2. Middleware TenantMiddleware intercepta
3. Extrai identificador:
   subdomain = "empresa-abc"
4. Busca tenant no banco (public schema):
   SELECT \* FROM public.tenants
   WHERE subdomain = 'empresa-abc'
5. Inicializa tenancy:
   SET search_path TO tenant_abc, public
6. Todas as queries agora vÃ£o para schema correto:
   SELECT \* FROM products
   // Automaticamente vai para: tenant_abc.products
7. Response retorna apenas dados deste tenant

8. Fim da requisiÃ§Ã£o:
   Reset search_path
   ImplementaÃ§Ã£o com Stancl/Tenancy
   php// config/tenancy.php

return [
'tenant_model' => \App\Models\Tenant::class,

    'database' => [
        // Cada tenant = um schema
        'prefix' => 'tenant',
        'suffix' => '',
    ],

    // Tenant detectado por domÃ­nio
    'identification' => [
        'domain' => [
            'env' => 'TENANT_',
        ],
    ],

];
php// app/Models/Tenant.php

class Tenant extends TenancyTenant
{
protected $fillable = [
'id',
'subdomain',
'company_name',
'company_tax_id', // NUIT
'status',
'plan',
'active_modules', // JSON
'trial_ends_at',
'subscription_ends_at',
];

    // Verifica se mÃ³dulo estÃ¡ ativo
    public function hasModule(string $module): bool
    {
        $modules = $this->active_modules ?? [];
        return in_array($module, $modules);
    }

    // Adiciona mÃ³dulo
    public function addModule(string $module): void
    {
        $modules = $this->active_modules ?? [];
        if (!in_array($module, $modules)) {
            $modules[] = $module;
            $this->update(['active_modules' => $modules]);
        }
    }

    // Remove mÃ³dulo
    public function removeModule(string $module): void
    {
        $modules = $this->active_modules ?? [];
        $modules = array_diff($modules, [$module]);
        $this->update(['active_modules' => array_values($modules)]);
    }

}
Middleware de Tenant
php// app/Http/Middleware/InitializeTenancyByDomain.php

class InitializeTenancyByDomain
{
public function handle(Request $request, Closure $next)
{
// Extrai subdomain
$host = $request->getHost();
$subdomain = explode('.', $host)[0];

        // Busca tenant
        $tenant = Tenant::where('subdomain', $subdomain)->firstOrFail();

        // Verifica status
        if ($tenant->status !== 'active') {
            abort(403, 'Tenant inativo');
        }

        // Verifica subscription
        if ($tenant->subscription_ends_at < now()) {
            abort(402, 'Assinatura expirada');
        }

        // Inicializa tenancy
        tenancy()->initialize($tenant);

        // Disponibiliza tenant no request
        $request->attributes->set('tenant', $tenant);

        return $next($request);
    }

}
CriaÃ§Ã£o de Novo Tenant (Onboarding)
php// app/Services/TenantOnboardingService.php

class TenantOnboardingService
{
public function register(array $data): Tenant
{
DB::beginTransaction();

        try {
            // 1. Criar tenant
            $tenant = Tenant::create([
                'subdomain' => Str::slug($data['company_name']),
                'company_name' => $data['company_name'],
                'company_tax_id' => $data['nuit'],
                'status' => 'active',
                'plan' => 'trial',
                'active_modules' => ['customers', 'catalog', 'sales'],
                'trial_ends_at' => now()->addDays(30),
            ]);

            // 2. Criar schema e migrar tabelas
            $tenant->run(function () {
                Artisan::call('tenants:migrate');
                Artisan::call('tenants:seed', ['--class' => 'TenantSeeder']);
            });

            // 3. Criar usuÃ¡rio admin
            $tenant->run(function () use ($data) {
                User::create([
                    'name' => $data['admin_name'],
                    'email' => $data['admin_email'],
                    'password' => Hash::make($data['password']),
                ])->assignRole('admin');
            });

            // 4. ConfiguraÃ§Ãµes iniciais
            $tenant->run(function () use ($data) {
                // Criar armazÃ©m padrÃ£o
                Warehouse::create([
                    'code' => 'ARM-01',
                    'name' => 'ArmazÃ©m Principal',
                    'is_default' => true,
                ]);

                // Criar sÃ©ries fiscais
                DocumentSeries::create([
                    'code' => 'FT',
                    'name' => 'Faturas',
                    'document_type' => 'invoice',
                    'current_number' => 0,
                ]);
            });

            DB::commit();

            // 5. Enviar email de boas-vindas
            Mail::to($data['admin_email'])->send(
                new WelcomeMail($tenant, $data['password'])
            );

            // 6. Notificar equipe
            Notification::route('slack', config('slack.webhook'))
                ->notify(new NewTenantCreated($tenant));

            return $tenant;

        } catch (\Exception $e) {
            DB::rollBack();

            // Log error
            Log::error('Tenant creation failed', [
                'data' => $data,
                'error' => $e->getMessage(),
            ]);

            throw $e;
        }
    }

}
AtivaÃ§Ã£o de MÃ³dulo
php// app/Services/ModuleActivationService.php

class ModuleActivationService
{
public function activate(Tenant $tenant, string $module): void
    {
        // Valida mÃ³dulo
        if (!in_array($module, ['customers', 'catalog', 'inventory', 'sales', 'invoicing', 'financial'])) {
throw new InvalidModuleException();
}

        // Verifica se jÃ¡ estÃ¡ ativo
        if ($tenant->hasModule($module)) {
            return;
        }

        $tenant->run(function () use ($module) {
            // Roda migrations especÃ­ficas do mÃ³dulo
            Artisan::call("module:migrate {$module}");

            // Seed de dados iniciais
            Artisan::call("module:seed {$module}");
        });

        // Atualiza tenant
        $tenant->addModule($module);

        // Event
        event(new ModuleActivated($tenant, $module));

        // Atualiza billing
        BillingService::addModuleToSubscription($tenant, $module);

        // Notifica admin do tenant
        $tenant->run(function () use ($module) {
            $admin = User::role('admin')->first();
            $admin->notify(new ModuleActivatedNotification($module));
        });
    }

    public function deactivate(Tenant $tenant, string $module): void
    {
        // NÃ£o pode desativar se tem dependÃªncias
        $dependencies = $this->checkDependencies($tenant, $module);
        if (!empty($dependencies)) {
            throw new ModuleHasDependenciesException($dependencies);
        }

        // Remove mÃ³dulo
        $tenant->removeModule($module);

        // Event
        event(new ModuleDeactivated($tenant, $module));

        // Atualiza billing
        BillingService::removeModuleFromSubscription($tenant, $module);
    }

}

```

### **Isolamento de Arquivos (S3)**
```

Estrutura no S3:

kutenga-files/
â”œâ”€ tenant-abc/
â”‚ â”œâ”€ products/
â”‚ â”‚ â”œâ”€ prod-001-img1.jpg
â”‚ â”‚ â””â”€ prod-002-img1.jpg
â”‚ â”œâ”€ invoices/
â”‚ â”‚ â”œâ”€ FT-2024-001.pdf
â”‚ â”‚ â””â”€ FT-2024-002.pdf
â”‚ â”œâ”€ documents/
â”‚ â””â”€ logos/
â”‚ â””â”€ logo.png
â”‚
â””â”€ tenant-xyz/
â”œâ”€ products/
â”œâ”€ invoices/
â””â”€ ...

Cada tenant sÃ³ acessa sua pasta

ðŸ—„ï¸ Estrutura do Banco de Dados
Tabelas Globais (Schema: public)
sql-- Tenants (empresas)
CREATE TABLE tenants (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
subdomain VARCHAR(63) UNIQUE NOT NULL,
company_name VARCHAR(255) NOT NULL,
company_tax_id VARCHAR(50), -- NUIT
status VARCHAR(20) DEFAULT 'active',
plan VARCHAR(50),
active_modules JSONB DEFAULT '[]'::jsonb,
trial_ends_at TIMESTAMP,
subscription_ends_at TIMESTAMP,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CHECK (status IN ('active', 'inactive', 'suspended', 'cancelled'))

);

-- UsuÃ¡rios (acesso ao sistema)
CREATE TABLE users (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
tenant_id UUID REFERENCES tenants(id) ON DELETE CASCADE,
name VARCHAR(255) NOT NULL,
email VARCHAR(255) NOT NULL,
password VARCHAR(255) NOT NULL,
email_verified_at TIMESTAMP,
two_factor_secret TEXT,
two_factor_recovery_codes TEXT,
remember_token VARCHAR(100),
last_login_at TIMESTAMP,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    UNIQUE(tenant_id, email)

);

-- Subscriptions (billing)
CREATE TABLE subscriptions (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
tenant_id UUID REFERENCES tenants(id) ON DELETE CASCADE,
plan VARCHAR(50) NOT NULL,
status VARCHAR(20),
modules JSONB,
monthly_cost DECIMAL(10,2),
billing_cycle VARCHAR(20),
next_billing_date DATE,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Ãndices
CREATE INDEX idx*tenants_subdomain ON tenants(subdomain);
CREATE INDEX idx_tenants_status ON tenants(status);
CREATE INDEX idx_users_tenant ON users(tenant_id);
CREATE INDEX idx_users_email ON users(tenant_id, email);
Tabelas por Tenant (Schema: tenant*\*)
Cada tenant tem cÃ³pia completa destas tabelas no seu schema.

NOTA: Por brevidade, apenas principais colunas. Veja seÃ§Ã£o de mÃ³dulos para detalhes completos.

sql-- MÃ“DULO: CUSTOMERS
CREATE TABLE customers (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
type VARCHAR(20) NOT NULL,
code VARCHAR(50) UNIQUE NOT NULL,
name VARCHAR(255) NOT NULL,
trade_name VARCHAR(255),
tax_id VARCHAR(50), -- NUIT
email VARCHAR(255),
phone VARCHAR(50),
status VARCHAR(20) DEFAULT 'active',
credit_limit DECIMAL(15,2),
current_balance DECIMAL(15,2) DEFAULT 0,
category_id UUID,
tags TEXT[],
custom_fields JSONB,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
deleted_at TIMESTAMP
);

CREATE TABLE customer_addresses (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
customer_id UUID REFERENCES customers(id) ON DELETE CASCADE,
type VARCHAR(20) NOT NULL,
street TEXT,
city VARCHAR(100),
state VARCHAR(100),
country VARCHAR(100),
postal_code VARCHAR(20),
is_primary BOOLEAN DEFAULT FALSE,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- MÃ“DULO: CATALOG
CREATE TABLE items (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
type VARCHAR(20) NOT NULL,
code VARCHAR(50) UNIQUE NOT NULL,
barcode VARCHAR(100),
name VARCHAR(255) NOT NULL,
description TEXT,
category_id UUID,
brand_id UUID,
status VARCHAR(20) DEFAULT 'active',

    -- CRÃTICO para integraÃ§Ã£o
    controls_inventory BOOLEAN DEFAULT FALSE,

    cost_price DECIMAL(15,2),
    sale_price DECIMAL(15,2),

    -- Se produto
    min_stock_level DECIMAL(15,3),
    max_stock_level DECIMAL(15,3),
    weight DECIMAL(10,3),
    dimensions JSONB,

    -- Se serviÃ§o
    duration INTEGER,
    requires_scheduling BOOLEAN DEFAULT FALSE,

    tax_config JSONB,
    images TEXT[],
    primary_image TEXT,
    custom_fields JSONB,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP,

    CHECK (type IN ('product', 'service'))

);

-- MÃ“DULO: INVENTORY
CREATE TABLE warehouses (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
code VARCHAR(50) UNIQUE NOT NULL,
name VARCHAR(255) NOT NULL,
type VARCHAR(50) DEFAULT 'physical',
status VARCHAR(20) DEFAULT 'active',
is_default BOOLEAN DEFAULT FALSE,
address TEXT,
city VARCHAR(100),
manager_name VARCHAR(255),
phone VARCHAR(50),
allows_negative_stock BOOLEAN DEFAULT FALSE,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
deleted_at TIMESTAMP
);

CREATE TABLE inventory_movements (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
product_id UUID REFERENCES items(id),
warehouse_id UUID REFERENCES warehouses(id),
type VARCHAR(20) NOT NULL,
reason VARCHAR(50) NOT NULL,
quantity DECIMAL(15,3) NOT NULL,
unit_cost DECIMAL(15,2),
total_cost DECIMAL(15,2),
lot_id UUID,
serial_number_id UUID,
expiration_date DATE,
source_warehouse_id UUID REFERENCES warehouses(id),
destination_warehouse_id UUID REFERENCES warehouses(id),
related_movement_id UUID,
location VARCHAR(100),
reference_type VARCHAR(50),
reference_id UUID,
reference_number VARCHAR(100),
notes TEXT,
performed_by UUID,
movement_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CHECK (quantity != 0),
    CHECK (type IN ('in', 'out', 'transfer'))

);

CREATE TABLE inventory_balances (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
product_id UUID REFERENCES items(id),
warehouse_id UUID REFERENCES warehouses(id),
quantity_available DECIMAL(15,3) DEFAULT 0 NOT NULL,
quantity_reserved DECIMAL(15,3) DEFAULT 0 NOT NULL,
quantity_in_transit DECIMAL(15,3) DEFAULT 0 NOT NULL,
quantity_total DECIMAL(15,3) GENERATED ALWAYS AS
(quantity_available + quantity_reserved) STORED,
average_cost DECIMAL(15,2) DEFAULT 0,
total_value DECIMAL(15,2) GENERATED ALWAYS AS
(quantity_total \* average_cost) STORED,
last_movement_id UUID,
last_movement_date TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    UNIQUE(product_id, warehouse_id),
    CHECK (quantity_available >= 0),
    CHECK (quantity_reserved >= 0)

);

-- MÃ“DULO: SALES
CREATE TABLE sales (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
sale_number VARCHAR(50) UNIQUE NOT NULL,
series VARCHAR(20),
customer_id UUID REFERENCES customers(id),
customer_snapshot JSONB,
type VARCHAR(20) NOT NULL,
status VARCHAR(20) DEFAULT 'draft',
subtotal DECIMAL(15,2) NOT NULL,
discount_amount DECIMAL(15,2) DEFAULT 0,
tax_amount DECIMAL(15,2) DEFAULT 0,
total_amount DECIMAL(15,2) NOT NULL,
global_discount JSONB,
paid_amount DECIMAL(15,2) DEFAULT 0,
balance_due DECIMAL(15,2),
quote_id UUID,
warehouse_id UUID REFERENCES warehouses(id),
seller_id UUID,
sale_date TIMESTAMP NOT NULL,
due_date DATE,
channel VARCHAR(20),
device_id VARCHAR(100),
notes TEXT,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
created_by UUID,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
cancelled_at TIMESTAMP,

    CHECK (type IN ('sale', 'quote', 'order')),
    CHECK (status IN ('draft', 'confirmed', 'paid', 'cancelled'))

);

CREATE TABLE sale_items (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
sale_id UUID REFERENCES sales(id) ON DELETE CASCADE,
item_id UUID REFERENCES items(id),
item_type VARCHAR(20) NOT NULL,
item_snapshot JSONB,
quantity DECIMAL(15,3) NOT NULL,
unit_id UUID,
unit_price DECIMAL(15,2) NOT NULL,
original_price DECIMAL(15,2),
discount_amount DECIMAL(15,2) DEFAULT 0,
subtotal DECIMAL(15,2) NOT NULL,
tax_rate DECIMAL(5,2),
tax_amount DECIMAL(15,2),
total_amount DECIMAL(15,2) NOT NULL,
item_discount JSONB,
lot_id UUID,
serial_number VARCHAR(255),
scheduled_for TIMESTAMP,
professional_id UUID,
notes TEXT,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- MÃ“DULO: INVOICING
CREATE TABLE invoices (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
sale_id UUID REFERENCES sales(id),
series VARCHAR(20) NOT NULL,
number VARCHAR(20) NOT NULL,
full_number VARCHAR(50) UNIQUE NOT NULL,
document_type VARCHAR(20) NOT NULL,
status VARCHAR(20) DEFAULT 'active',
fiscal_status VARCHAR(20) DEFAULT 'pending',
customer_id UUID REFERENCES customers(id),
customer_data JSONB,
subtotal DECIMAL(15,2) NOT NULL,
discount_amount DECIMAL(15,2) DEFAULT 0,
tax_amount DECIMAL(15,2) DEFAULT 0,
total_amount DECIMAL(15,2) NOT NULL,
fiscal_data JSONB,
related_invoice_id UUID REFERENCES invoices(id),
issue_date TIMESTAMP NOT NULL,
due_date DATE,
valid_until DATE,
pdf_url TEXT,
pdf_generated_at TIMESTAMP,
sent_at TIMESTAMP,
sent_to VARCHAR(255),
cancelled_at TIMESTAMP,
cancelled_by UUID,
cancellation_reason TEXT,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
created_by UUID
);

-- MÃ“DULO: FINANCIAL
CREATE TABLE accounts_receivable (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
customer_id UUID REFERENCES customers(id),
invoice_id UUID REFERENCES invoices(id),
sale_id UUID REFERENCES sales(id),
original_amount DECIMAL(15,2) NOT NULL,
paid_amount DECIMAL(15,2) DEFAULT 0,
balance_due DECIMAL(15,2),
installment_number INTEGER,
total_installments INTEGER,
issue_date DATE NOT NULL,
due_date DATE NOT NULL,
paid_at TIMESTAMP,
status VARCHAR(20) DEFAULT 'open',
days_past_due INTEGER,
interest_amount DECIMAL(15,2),
penalty_amount DECIMAL(15,2),
notes TEXT,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CHECK (status IN ('open', 'partial', 'paid', 'overdue', 'cancelled'))

);

CREATE TABLE bank_accounts (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
bank_name VARCHAR(255) NOT NULL,
account_number VARCHAR(100) NOT NULL,
account_type VARCHAR(20),
currency VARCHAR(3) DEFAULT 'MZN',
current_balance DECIMAL(15,2) DEFAULT 0,
is_default BOOLEAN DEFAULT FALSE,
status VARCHAR(20) DEFAULT 'active',
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE cash_flow_entries (
id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
type VARCHAR(20) NOT NULL,
category VARCHAR(100),
amount DECIMAL(15,2) NOT NULL,
transaction_date DATE NOT NULL,
effective_date DATE NOT NULL,
bank_account_id UUID REFERENCES bank_accounts(id),
reference_type VARCHAR(50),
reference_id UUID,
is_recurring BOOLEAN DEFAULT FALSE,
recurrence_pattern VARCHAR(50),
status VARCHAR(20) DEFAULT 'confirmed',
description TEXT,
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CHECK (type IN ('inflow', 'outflow'))

);
Ãndices Importantes
sql-- Customers
CREATE INDEX idx_customers_code ON customers(code);
CREATE INDEX idx_customers_tax_id ON customers(tax_id);
CREATE INDEX idx_customers_status ON customers(status);
CREATE INDEX idx_customers_balance ON customers(current_balance)
WHERE current_balance > 0;

-- Items
CREATE INDEX idx_items_code ON items(code);
CREATE INDEX idx_items_barcode ON items(barcode);
CREATE INDEX idx_items_type ON items(type);
CREATE INDEX idx_items_controls_inventory ON items(controls_inventory);
CREATE INDEX idx_items_category ON items(category_id);
CREATE INDEX idx_items_status ON items(status);

-- Inventory
CREATE INDEX idx_movements_product ON inventory_movements(product_id);
CREATE INDEX idx_movements_warehouse ON inventory_movements(warehouse_id);
CREATE INDEX idx_movements_date ON inventory_movements(movement_date DESC);
CREATE INDEX idx_movements_type ON inventory_movements(type);
CREATE INDEX idx_movements_reference ON inventory_movements(reference_type, reference_id);

CREATE INDEX idx_balances_product ON inventory_balances(product_id);
CREATE INDEX idx_balances_warehouse ON inventory_balances(warehouse_id);
CREATE INDEX idx_balances_low_stock ON inventory_balances(product_id)
WHERE quantity_available < 10;

-- Sales
CREATE INDEX idx_sales_customer ON sales(customer_id);
CREATE INDEX idx_sales_date ON sales(sale_date DESC);
CREATE INDEX idx_sales_status ON sales(status);
CREATE INDEX idx_sales_seller ON sales(seller_id);
CREATE INDEX idx_sales_warehouse ON sales(warehouse_id);

CREATE INDEX idx_sale_items_sale ON sale_items(sale_id);
CREATE INDEX idx_sale_items_item ON sale_items(item_id);

-- Invoices
CREATE INDEX idx_invoices_sale ON invoices(sale_id);
CREATE INDEX idx_invoices_customer ON invoices(customer_id);
CREATE INDEX idx_invoices_date ON invoices(issue_date DESC);
CREATE INDEX idx_invoices_status ON invoices(status);
CREATE INDEX idx_invoices_full_number ON invoices(full_number);

-- Financial
CREATE INDEX idx_receivables_customer ON accounts_receivable(customer_id);
CREATE INDEX idx_receivables_status ON accounts_receivable(status);
CREATE INDEX idx_receivables_due_date ON accounts_receivable(due_date);
CREATE INDEX idx_receivables_overdue ON accounts_receivable(due_date)
WHERE status IN ('open', 'partial', 'overdue');

CREATE INDEX idx_cash_flow_date ON cash_flow_entries(transaction_date);
CREATE INDEX idx_cash_flow_type ON cash_flow_entries(type);
CREATE INDEX idx_cash_flow_account ON cash_flow_entries(bank_account_id);

ðŸ“ Estrutura de DiretÃ³rios
kutenga-erp/
â”‚
â”œâ”€â”€ app/
â”‚ â”œâ”€â”€ Console/
â”‚ â”‚ â”œâ”€â”€ Commands/
â”‚ â”‚ â”‚ â”œâ”€â”€ TenantCreate.php
â”‚ â”‚ â”‚ â”œâ”€â”€ ModuleActivate.php
â”‚ â”‚ â”‚ â””â”€â”€ ...
â”‚ â”‚ â””â”€â”€ Kernel.php
â”‚ â”‚
â”‚ â”œâ”€â”€ Events/
â”‚ â”‚ â”œâ”€â”€ Sales/
â”‚ â”‚ â”‚ â”œâ”€â”€ SaleConfirmed.php
â”‚ â”‚ â”‚ â”œâ”€â”€ SaleCancelled.php
â”‚ â”‚ â”‚ â””â”€â”€ ...
â”‚ â”‚ â”œâ”€â”€ Inventory/
â”‚ â”‚ â”‚ â”œâ”€â”€ StockLow.php
â”‚ â”‚ â”‚ â”œâ”€â”€ MovementRegistered.php
â”‚ â”‚ â”‚ â””â”€â”€ ...
â”‚ â”‚ â”œâ”€â”€ Invoicing/
â”‚ â”‚ â”‚ â”œâ”€â”€ InvoiceGenerated.php
â”‚ â”‚ â”‚ â””â”€â”€ ...
â”‚ â”‚ â””â”€â”€ Financial/
â”‚ â”‚ â”œâ”€â”€ ReceivableOverdue.php
â”‚ â”‚ â””â”€â”€ ...
â”‚ â”‚
â”‚ â”œâ”€â”€ Exceptions/
â”‚ â”‚ â”œâ”€â”€ Handler.php
â”‚ â”‚ â”œâ”€â”€ InsufficientStockException.php
â”‚ â”‚ â”œâ”€â”€ TenantNotFoundException.php
â”‚ â”‚ â”œâ”€â”€ ModuleNotActiveException.php
â”‚ â”‚ â””â”€â”€ ...
â”‚ â”‚
â”‚ â”œâ”€â”€ Http/
â”‚ â”‚ â”œâ”€â”€ Controllers/
â”‚ â”‚ â”‚ â”œâ”€â”€ Api/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Customers/
â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ CustomerController.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Catalog/
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ItemController.php
â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ CategoryController.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Inventory/
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ WarehouseController.php
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ MovementController.php
â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ BalanceController.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Sales/
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ SaleController.php
â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ QuoteController.php
â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ PaymentController.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ Invoicing/
â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ InvoiceController.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ Financial/
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ ReceivableController.php
â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ PayableController.php
â”‚ â”‚ â”‚ â”‚ â””â”€â”€ CashFlowController.php
â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€ Web/
â”‚ â”‚ â”‚ â”œâ”€â”€ DashboardController.php
â”‚ â”‚ â”‚ â””â”€â”€ ...
â”‚ â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Middleware/
â”‚ â”‚ â”‚ â”œâ”€â”€ InitializeTenancyByDomain.php
â”‚ â”‚ â”‚ â”œâ”€â”€ EnsureModuleIsActive.
â”‚   â”‚   â”‚   â”œâ”€â”€ CheckUserPermission.php
â”‚   â”‚   â”‚   â””â”€â”€ AuditLog.php
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Requests/
â”‚   â”‚       â”œâ”€â”€ Customers/
â”‚   â”‚       â”‚   â”œâ”€â”€ StoreCustomerRequest.php
â”‚   â”‚       â”‚   â””â”€â”€ UpdateCustomerRequest.php
â”‚   â”‚       â”œâ”€â”€ Inventory/
â”‚   â”‚       â”‚   â””â”€â”€ RegisterMovementRequest.php
â”‚   â”‚       â”œâ”€â”€ Sales/
â”‚   â”‚       â”‚   â””â”€â”€ CreateSaleRequest.php
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ Jobs/
â”‚   â”‚   â”œâ”€â”€ ProcessInventoryMovement.php
â”‚   â”‚   â”œâ”€â”€ GenerateInvoicePdf.php
â”‚   â”‚   â”œâ”€â”€ SendInvoiceEmail.php
â”‚   â”‚   â”œâ”€â”€ SendPaymentReminder.php
â”‚   â”‚   â”œâ”€â”€ CheckOverdueReceivables.php
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ Listeners/
â”‚   â”‚   â”œâ”€â”€ Sales/
â”‚   â”‚   â”‚   â”œâ”€â”€ UpdateInventoryOnSaleConfirmed.php
â”‚   â”‚   â”‚   â”œâ”€â”€ GenerateInvoiceOnSaleConfirmed.php
â”‚   â”‚   â”‚   â”œâ”€â”€ CreateReceivableOnSaleConfirmed.php
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ Inventory/
â”‚   â”‚   â”‚   â”œâ”€â”€ SendLowStockAlert.php
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ Financial/
â”‚   â”‚       â”œâ”€â”€ BlockCustomerOnOverdue.php
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”œâ”€â”€ Tenant.php
â”‚   â”‚   â”œâ”€â”€ User.php
â”‚   â”‚   â”œâ”€â”€ Customer.php
â”‚   â”‚   â”œâ”€â”€ CustomerAddress.php
â”‚   â”‚   â”œâ”€â”€ Item.php
â”‚   â”‚   â”œâ”€â”€ Product.php
â”‚   â”‚   â”œâ”€â”€ Service.php
â”‚   â”‚   â”œâ”€â”€ Category.php
â”‚   â”‚   â”œâ”€â”€ Warehouse.php
â”‚   â”‚   â”œâ”€â”€ InventoryMovement.php
â”‚   â”‚   â”œâ”€â”€ InventoryBalance.php
â”‚   â”‚   â”œâ”€â”€ Lot.php
â”‚   â”‚   â”œâ”€â”€ Sale.php
â”‚   â”‚   â”œâ”€â”€ SaleItem.php
â”‚   â”‚   â”œâ”€â”€ Payment.php
â”‚   â”‚   â”œâ”€â”€ Invoice.php
â”‚   â”‚   â”œâ”€â”€ InvoiceItem.php
â”‚   â”‚   â”œâ”€â”€ AccountReceivable.php
â”‚   â”‚   â”œâ”€â”€ AccountPayable.php
â”‚   â”‚   â”œâ”€â”€ BankAccount.php
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ Policies/
â”‚   â”‚   â”œâ”€â”€ CustomerPolicy.php
â”‚   â”‚   â”œâ”€â”€ SalePolicy.php
â”‚   â”‚   â”œâ”€â”€ InvoicePolicy.php
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ Providers/
â”‚   â”‚   â”œâ”€â”€ AppServiceProvider.php
â”‚   â”‚   â”œâ”€â”€ AuthServiceProvider.php
â”‚   â”‚   â”œâ”€â”€ EventServiceProvider.php
â”‚   â”‚   â””â”€â”€ RouteServiceProvider.php
â”‚   â”‚
â”‚   â”œâ”€â”€ Repositories/
â”‚   â”‚   â”œâ”€â”€ Contracts/
â”‚   â”‚   â”‚   â”œâ”€â”€ CustomerRepositoryInterface.php
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductRepositoryInterface.php
â”‚   â”‚   â”‚   â”œâ”€â”€ InventoryRepositoryInterface.php
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ Eloquent/
â”‚   â”‚       â”œâ”€â”€ CustomerRepository.php
â”‚   â”‚       â”œâ”€â”€ ProductRepository.php
â”‚   â”‚       â”œâ”€â”€ InventoryRepository.php
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ Services/
â”‚       â”œâ”€â”€ Customers/
â”‚       â”‚   â””â”€â”€ CustomerService.php
â”‚       â”œâ”€â”€ Catalog/
â”‚       â”‚   â””â”€â”€ CatalogService.php
â”‚       â”œâ”€â”€ Inventory/
â”‚       â”‚   â”œâ”€â”€ InventoryService.php
â”‚       â”‚   â”œâ”€â”€ MovementService.php
â”‚       â”‚   â”œâ”€â”€ BalanceCalculator.php
â”‚       â”‚   â””â”€â”€ StockValidator.php
â”‚       â”œâ”€â”€ Sales/
â”‚       â”‚   â”œâ”€â”€ SalesService.php
â”‚       â”‚   â”œâ”€â”€ PricingEngine.php
â”‚       â”‚   â””â”€â”€ PaymentProcessor.php
â”‚       â”œâ”€â”€ Invoicing/
â”‚       â”‚   â”œâ”€â”€ InvoicingService.php
â”‚       â”‚   â”œâ”€â”€ DocumentNumbering.php
â”‚       â”‚   â””â”€â”€ PdfGenerator.php
â”‚       â”œâ”€â”€ Financial/
â”‚       â”‚   â”œâ”€â”€ ReceivableService.php
â”‚       â”‚   â”œâ”€â”€ PayableService.php
â”‚       â”‚   â””â”€â”€ CashFlowService.php
â”‚       â””â”€â”€ Tenant/
â”‚           â”œâ”€â”€ TenantOnboardingService.php
â”‚           â””â”€â”€ ModuleActivationService.php
â”‚
â”œâ”€â”€ bootstrap/
â”‚   â””â”€â”€ app.php
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ app.php
â”‚   â”œâ”€â”€ database.php
â”‚   â”œâ”€â”€ tenancy.php
â”‚   â”œâ”€â”€ modules.php
â”‚   â”œâ”€â”€ invoicing.php
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”œâ”€â”€ landlord/
â”‚   â”‚   â”‚   â”œâ”€â”€ 2024_01_01_create_tenants_table.php
â”‚   â”‚   â”‚   â”œâ”€â”€ 2024_01_02_create_users_table.php
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ tenant/
â”‚   â”‚       â”œâ”€â”€ 2024_01_03_create_customers_table.php
â”‚   â”‚       â”œâ”€â”€ 2024_01_04_create_items_table.php
â”‚   â”‚       â”œâ”€â”€ 2024_01_05_create_warehouses_table.php
â”‚   â”‚       â”œâ”€â”€ 2024_01_06_create_inventory_movements_table.php
â”‚   â”‚       â”œâ”€â”€ 2024_01_07_create_sales_table.php
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ seeders/
â”‚   â”‚   â”œâ”€â”€ TenantSeeder.php
â”‚   â”‚   â”œâ”€â”€ UserSeeder.php
â”‚   â”‚   â”œâ”€â”€ DemoDataSeeder.php
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ factories/
â”‚       â”œâ”€â”€ CustomerFactory.php
â”‚       â”œâ”€â”€ ProductFactory.php
â”‚       â”œâ”€â”€ SaleFactory.php
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ app.tsx
â”‚   â”‚   â”œâ”€â”€ bootstrap.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Common/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Select.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Table.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Alert.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AppLayout.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Customers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CustomerList.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CustomerForm.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CustomerDetails.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Catalog/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ItemList.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ItemForm.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CategoryTree.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Inventory/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WarehouseList.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MovementForm.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BalanceTable.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PhysicalInventory.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LowStockAlert.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Sales/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ POSScreen.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SalesList.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ QuoteForm.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentModal.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Invoicing/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InvoiceList.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InvoicePreview.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InvoiceTemplate.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ Financial/
â”‚   â”‚   â”‚       â”œâ”€â”€ ReceivableList.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ PayableList.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ CashFlowChart.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ DREReport.tsx
â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useTenant.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ usePermissions.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useModules.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Auth/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Login.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Register.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Index.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Customers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Index.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Create.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Edit.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Show.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Inventory/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Movements.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Balances.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Reports.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Sales/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ POS.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Index.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ customerService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ inventoryService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ salesService.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Store/
â”‚   â”‚   â”‚   â”œâ”€â”€ authStore.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ cartStore.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ settingsStore.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Types/
â”‚   â”‚   â”‚   â”œâ”€â”€ customer.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ product.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ sale.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ inventory.ts
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Utils/
â”‚   â”‚       â”œâ”€â”€ formatters.ts
â”‚   â”‚       â”œâ”€â”€ validators.ts
â”‚   â”‚       â”œâ”€â”€ currency.ts
â”‚   â”‚       â””â”€â”€ helpers.ts
â”‚   â”‚
â”‚   â””â”€â”€ css/
â”‚       â””â”€â”€ app.css
â”‚
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ api.php
â”‚   â”œâ”€â”€ web.php
â”‚   â”œâ”€â”€ tenant.php
â”‚   â””â”€â”€ channels.php
â”‚
â”œâ”€â”€ storage/
â”‚   â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ framework/
â”‚   â””â”€â”€ logs/
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ Feature/
â”‚   â”‚   â”œâ”€â”€ Auth/
â”‚   â”‚   â”œâ”€â”€ Customers/
â”‚   â”‚   â”œâ”€â”€ Inventory/
â”‚   â”‚   â”‚   â”œâ”€â”€ MovementTest.php
â”‚   â”‚   â”‚   â”œâ”€â”€ BalanceTest.php
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ Sales/
â”‚   â”‚   â”‚   â”œâ”€â”€ SaleTest.php
â”‚   â”‚   â”‚   â”œâ”€â”€ QuoteTest.php
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ Unit/
â”‚       â”œâ”€â”€ Services/
â”‚       â”‚   â”œâ”€â”€ InventoryServiceTest.php
â”‚       â”‚   â”œâ”€â”€ PricingEngineTest.php
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”œâ”€â”€ Repositories/
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ artisan
â”œâ”€â”€ composer.json
â”œâ”€â”€ package.json
â”œâ”€â”€ phpunit.xml
â”œâ”€â”€ README.md
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vite.config.js

---

## ðŸ”„ IntegraÃ§Ã£o entre MÃ³dulos

### **Sistema de Eventos**

KUTENGA usa **Event-Driven Architecture** para comunicaÃ§Ã£o desacoplada.

#### **Principais Eventos**
```php
// Eventos de Vendas
SaleConfirmed         // Venda confirmada
SaleCancelled         // Venda cancelada
QuoteConverted        // CotaÃ§Ã£o convertida em venda

// Eventos de Estoque
StockLow              // Estoque baixo
StockOut              // Ruptura de estoque
MovementRegistered    // MovimentaÃ§Ã£o registrada
InventoryAdjusted     // Ajuste de estoque

// Eventos de FaturaÃ§Ã£o
InvoiceGenerated      // Fatura gerada
InvoiceCancelled      // Fatura cancelada
InvoiceSent           // Fatura enviada

// Eventos de Financeiro
ReceivableOverdue     // Conta vencida
PaymentReceived       // Pagamento recebido
CustomerBlocked       // Cliente bloqueado
```

#### **Exemplo Completo: Fluxo de Venda**
```php
// 1. Controller confirma venda
class SaleController extends Controller
{
    public function confirm(Sale $sale)
    {
        $sale->update(['status' => 'confirmed']);
        
        // Dispara evento
        event(new SaleConfirmed($sale));
        
        return response()->json([
            'message' => 'Venda confirmada com sucesso',
            'sale' => new SaleResource($sale),
        ]);
    }
}

// 2. Listener: Atualiza Estoque
class UpdateInventoryOnSaleConfirmed
{
    public function __construct(
        private MovementService $movementService
    ) {}
    
    public function handle(SaleConfirmed $event): void
    {
        // Verifica se mÃ³dulo estÃ¡ ativo
        if (!tenant()->hasModule('inventory')) {
            return;
        }
        
        $sale = $event->sale;
        
        foreach ($sale->items as $item) {
            // SÃ³ processa produtos
            if ($item->item_type !== 'product') {
                continue;
            }
            
            // Verifica se produto controla estoque
            $product = $item->item;
            if (!$product->controls_inventory) {
                continue;
            }
            
            // Registra movimentaÃ§Ã£o de saÃ­da
            $this->movementService->register([
                'product_id' => $item->item_id,
                'warehouse_id' => $sale->warehouse_id,
                'type' => 'out',
                'reason' => 'sale',
                'quantity' => -$item->quantity,
                'reference_type' => 'sale',
                'reference_id' => $sale->id,
                'lot_id' => $item->lot_id,
                'serial_number' => $item->serial_number,
                'performed_by' => $sale->created_by,
            ]);
        }
    }
}

// 3. Listener: Gera Fatura
class GenerateInvoiceOnSaleConfirmed
{
    public function __construct(
        private InvoicingService $invoicingService
    ) {}
    
    public function handle(SaleConfirmed $event): void
    {
        // Verifica se mÃ³dulo estÃ¡ ativo
        if (!tenant()->hasModule('invoicing')) {
            return;
        }
        
        $sale = $event->sale;
        
        // Gera fatura
        $invoice = $this->invoicingService->generateFromSale($sale);
        
        // Atualiza venda com invoice_id
        $sale->update(['invoice_id' => $invoice->id]);
        
        // Dispara evento de fatura gerada
        event(new InvoiceGenerated($invoice));
    }
}

// 4. Listener: Cria Conta a Receber
class CreateReceivableOnSaleConfirmed
{
    public function __construct(
        private ReceivableService $receivableService
    ) {}
    
    public function handle(SaleConfirmed $event): void
    {
        // Verifica se mÃ³dulo estÃ¡ ativo
        if (!tenant()->hasModule('financial')) {
            return;
        }
        
        $sale = $event->sale;
        
        // Se venda Ã  vista, nÃ£o cria conta a receber
        if ($sale->balance_due <= 0) {
            return;
        }
        
        // Cria conta a receber
        $this->receivableService->create([
            'customer_id' => $sale->customer_id,
            'sale_id' => $sale->id,
            'invoice_id' => $sale->invoice_id,
            'original_amount' => $sale->balance_due,
            'issue_date' => $sale->sale_date,
            'due_date' => $sale->due_date,
        ]);
    }
}

// 5. Registro de Listeners
// app/Providers/EventServiceProvider.php

protected $listen = [
    SaleConfirmed::class => [
        UpdateInventoryOnSaleConfirmed::class,
        GenerateInvoiceOnSaleConfirmed::class,
        CreateReceivableOnSaleConfirmed::class,
    ],
];
```

#### **Diagrama de Fluxo**
USER: Confirma venda no POS
â†“
SALES: Atualiza status â†’ "confirmed"
â†“
EVENT: SaleConfirmed disparado
â†“
â”œâ”€â†’ LISTENER 1: UpdateInventoryOnSaleConfirmed
â”‚   â”œâ”€ hasModule('inventory')? â†’ SIM
â”‚   â”œâ”€ Para cada produto na venda:
â”‚   â”‚  â”œâ”€ Verifica controls_inventory
â”‚   â”‚  â”œâ”€ Cria movimento de saÃ­da
â”‚   â”‚  â””â”€ Atualiza saldo
â”‚   â””â”€ âœ… Estoque atualizado
â”‚
â”œâ”€â†’ LISTENER 2: GenerateInvoiceOnSaleConfirmed
â”‚   â”œâ”€ hasModule('invoicing')? â†’ SIM
â”‚   â”œâ”€ Gera fatura
â”‚   â”œâ”€ Atribui numeraÃ§Ã£o
â”‚   â”œâ”€ Calcula impostos
â”‚   â”œâ”€ Gera QR Code
â”‚   â”œâ”€ Cria PDF
â”‚   â””â”€ âœ… Fatura gerada
â”‚
â””â”€â†’ LISTENER 3: CreateReceivableOnSaleConfirmed
â”œâ”€ hasModule('financial')? â†’ SIM
â”œâ”€ balance_due > 0? â†’ SIM (a prazo)
â”œâ”€ Cria conta a receber
â”œâ”€ Agenda cobranÃ§a
â””â”€ âœ… Financeiro atualizado
RESULTADO FINAL:
âœ… Venda confirmada
âœ… Estoque atualizado
âœ… Fatura emitida
âœ… Conta a receber criada
âœ… Cliente notificado
TEMPO TOTAL: < 3 segundos

---

## ðŸ“± Dashboard e Interface

### **Layout Principal**
```typescript
// AppLayout.tsx

export default function AppLayout({ children }) {
  const { tenant, modules } = usePage().props
  
  return (
    <div className="min-h-screen bg-gray-100">
      {/* Sidebar */}
      <Sidebar modules={modules} />
      
      {/* Main Area */}
      <div className="md:pl-64">
        {/* Header */}
        <Header tenant={tenant} />
        
        {/* Content */}
        <main className="py-6">
          <div className="mx-auto max-w-7xl px-4 sm:px-6 md:px-8">
            {children}
          </div>
        </main>
      </div>
    </div>
  )
}
```

### **Dashboard Principal**
```typescript
// Dashboard/Index.tsx

interface DashboardProps {
  stats: {
    total_customers: number
    total_products: number
    total_sales_today: number
    total_sales_month: number
    inventory_value: number
    pending_receivables: number
    overdue_receivables: number
  }
  charts: {
    sales_trend: { date: string, amount: number }[]
    top_products: { name: string, quantity: number }[]
  }
  alerts: {
    low_stock: Product[]
    overdue_bills: AccountReceivable[]
  }
  recent_sales: Sale[]
  active_modules: string[]
}

export default function Dashboard(props: DashboardProps) {
  return (
    <AppLayout title="Dashboard">
      {/* Stats Cards */}
      <div className="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
        <StatsCard
          title="Clientes"
          value={props.stats.total_customers}
          icon={UsersIcon}
        />
        
        <StatsCard
          title="Vendas Hoje"
          value={`${props.stats.total_sales_today.toLocaleString()} MT`}
          icon={ShoppingCartIcon}
          trend="+12%"
        />
        
        {props.active_modules.includes('inventory') && (
          <StatsCard
            title="Valor em Estoque"
            value={`${props.stats.inventory_value.toLocaleString()} MT`}
            icon={CubeIcon}
          />
        )}
        
        {props.active_modules.includes('financial') && (
          <StatsCard
            title="A Receber"
            value={`${props.stats.pending_receivables.toLocaleString()} MT`}
            icon={BanknotesIcon}
            subtitle={`${props.stats.overdue_receivables.toLocaleString()} MT vencido`}
            alert={props.stats.overdue_receivables > 0}
          />
        )}
      </div>

      {/* Charts */}
      <div className="mt-6 grid grid-cols-1 gap-6 lg:grid-cols-2">
        {/* Sales Trend */}
        <Card title="Vendas (Ãšltimos 30 dias)">
          <LineChart
            data={props.charts.sales_trend}
            xKey="date"
            yKey="amount"
          />
        </Card>

        {/* Top Products */}
        <Card title="Produtos Mais Vendidos">
          <BarChart
            data={props.charts.top_products}
            xKey="name"
            yKey="quantity"
          />
        </Card>
      </div>

      {/* Alerts */}
      {(props.alerts.low_stock.length > 0 || 
        props.alerts.overdue_bills.length > 0) && (
        <div className="mt-6 grid grid-cols-1 gap-6 lg:grid-cols-2">
          {/* Low Stock Alert */}
          {props.active_modules.includes('inventory') && 
           props.alerts.low_stock.length > 0 && (
            <Alert variant="warning" title="Estoque Baixo">
              <ul className="mt-2 space-y-1">
                {props.alerts.low_stock.slice(0, 5).map(product => (
                  <li key={product.id}>
                    <strong>{product.name}</strong>: {product.available} unidades
                  </li>
                ))}
              </ul>
              <Link 
                href="/inventory/balances?filter=low_stock"
                className="mt-3 text-sm font-medium text-yellow-700"
              >
                Ver todos ({props.alerts.low_stock.length})
              </Link>
            </Alert>
          )}

          {/* Overdue Bills */}
          {props.active_modules.includes('financial') && 
           props.alerts.overdue_bills.length > 0 && (
            <Alert variant="error" title="Contas Vencidas">
              <ul className="mt-2 space-y-1">
                {props.alerts.overdue_bills.slice(0, 5).map(bill => (
                  <li key={bill.id}>
                    <strong>{bill.customer.name}</strong>: {
                      bill.balance_due.toLocaleString()
                    } MT ({bill.days_past_due} dias)
                  </li>
                ))}
              </ul>
              <Link 
                href="/financial/receivables?filter=overdue"
                className="mt-3 text-sm font-medium text-red-700"
              >
                Ver todos ({props.alerts.overdue_bills.length})
              </Link>
            </Alert>
          )}
        </div>
      )}

      {/* Recent Sales */}
      <div className="mt-6">
        <Card title="Vendas Recentes">
          <Table
            columns={[
              { key: 'sale_number', label: 'NÃºmero' },
              { key: 'customer.name', label: 'Cliente' },
              { key: 'total_amount', label: 'Valor', format: 'currency' },
              { key: 'sale_date', label: 'Data', format: 'datetime' },
              { key: 'status', label: 'Status', format: 'badge' },
            ]}
            data={props.recent_sales}
            onRowClick={(sale) => router.visit(`/sales/${sale.id}`)}
          />
        </Card>
      </div>
    </AppLayout>
  )
}
```

### **Sidebar com MÃ³dulos**
```typescript
// Sidebar.tsx

export default function Sidebar({ modules }: { modules: string[] }) {
  const navigation = [
    {
      name: 'Dashboard',
      href: '/dashboard',
      icon: HomeIcon,
      always: true,
    },
    
    // MÃ³dulo Customers
    {
      name: 'Clientes',
      icon: UsersIcon,
      module: 'customers',
      children: [
        { name: 'Lista', href: '/customers' },
        { name: 'Novo Cliente', href: '/customers/create' },
        { name: 'Categorias', href: '/customers/categories' },
      ],
    },
    
    // MÃ³dulo Catalog
    {
      name: 'CatÃ¡logo',
      icon: BookOpenIcon,
      module: 'catalog',
      children: [
        { name: 'Produtos', href: '/items/products' },
        { name: 'ServiÃ§os', href: '/items/services' },
        { name: 'Categorias', href: '/categories' },
        { name: 'Marcas', href: '/brands' },
      ],
    },
    
    // MÃ³dulo Inventory
    {
      name: 'Estoque',
      icon: CubeIcon,
      module: 'inventory',
      badge: '3', // Alertas
      children: [
        { name: 'Dashboard', href: '/inventory/dashboard' },
        { name: 'Saldos', href: '/inventory/balances' },
        { name: 'MovimentaÃ§Ãµes', href: '/inventory/movements' },
        { name: 'ArmazÃ©ns', href: '/inventory/warehouses' },
        { name: 'InventÃ¡rio FÃ­sico', href: '/inventory/physical' },
        { name: 'RelatÃ³rios', href: '/inventory/reports' },
      ],
    },
    
    // MÃ³dulo Sales
    {
      name: 'Vendas',
      icon: ShoppingCartIcon,
      module: 'sales',
      children: [
        { name: 'POS', href: '/sales/pos', icon: ComputerDesktopIcon },
        { name: 'Vendas', href: '/sales' },
        { name: 'CotaÃ§Ãµes', href: '/sales/quotes' },
        { name: 'Caixa', href: '/sales/cash-register' },
      ],
    },
    
    // MÃ³dulo Invoicing
    {
      name: 'FaturaÃ§Ã£o',
      icon: DocumentTextIcon,
      module: 'invoicing',
      children: [
        { name: 'Documentos', href: '/invoices' },
        { name: 'SÃ©ries', href: '/invoice-series' },
        { name: 'ConfiguraÃ§Ãµes Fiscais', href: '/invoices/tax-config' },
        { name: 'RelatÃ³rios', href: '/invoices/reports' },
      ],
    },
    
    // MÃ³dulo Financial
    {
      name: 'Financeiro',
      icon: BanknotesIcon,
      module: 'financial',
      badge: '8', // Contas vencidas
      children: [
        { name: 'Dashboard', href: '/financial/dashboard' },
        { name: 'Contas a Receber', href: '/financial/receivables' },
        { name: 'Contas a Pagar', href: '/financial/payables' },
        { name: 'Fluxo de Caixa', href: '/financial/cash-flow' },
        { name: 'Contas BancÃ¡rias', href: '/financial/bank-accounts' },
        { name: 'RelatÃ³rios', href: '/financial/reports' },
      ],
    },
  ]

  return (
    <div className="fixed inset-y-0 left-0 z-50 w-64 bg-gray-900">
      {/* Logo */}
      <div className="flex h-16 items-center px-6">
        <h1 className="text-xl font-bold text-white">KUTENGA ERP</h1>
      </div>

      {/* Navigation */}
      <nav className="mt-6 px-3">
        {navigation.map((item) => {
          // Se mÃ³dulo nÃ£o estÃ¡ ativo, mostra bloqueado
          if (item.module && !modules.includes(item.module)) {
            return (
              <div key={item.name} className="group mb-2">
                <div className="flex items-center justify-between rounded-lg px-3 py-2 text-gray-400">
                  <div className="flex items-center">
                    <item.icon className="mr-3 h-5 w-5" />
                    <span>{item.name}</span>
                  </div>
                  <LockClosedIcon className="h-4 w-4" />
                </div>
                <button 
                  onClick={() => router.visit('/subscription/upgrade')}
                  className="ml-11 mt-1 text-xs text-blue-400 hover:text-blue-300"
                >
                  Contratar MÃ³dulo
                </button>
              </div>
            )
          }

          return (
            <NavigationItem key={item.name} item={item} />
          )
        })}
      </nav>

      {/* Footer */}
      <div className="absolute bottom-0 w-full border-t border-gray-800 p-4">
        <Link
          href="/settings"
          className="flex items-center text-gray-300 hover:text-white"
        >
          <Cog6ToothIcon className="mr-3 h-5 w-5" />
          ConfiguraÃ§Ãµes
        </Link>
      </div>
    </div>
  )
}
```

### **Tela de POS (Ponto de Venda)**
```typescript
// Sales/POS.tsx

export default function POSScreen() {
  const [cart, setCart] = useState<CartItem[]>([])
  const [customer, setCustomer] = useState<Customer | null>(null)
  const [showPayment, setShowPayment] = useState(false)

  const handleAddToCart = (item: Item, quantity: number) => {
    // Valida estoque se produto
    if (item.type === 'product' && item.controls_inventory) {
      if (item.available_quantity < quantity) {
        toast.error(`Estoque insuficiente. DisponÃ­vel: ${item.available_quantity}`)
        return
      }
    }
    
    // Adiciona ao carrinho
    setCart(prev => [...prev, { item, quantity }])
  }

  const cartTotal = cart.reduce((sum, item) => 
    sum + (item.item.sale_price * item.quantity), 0
  )

  return (
    <AppLayout title="Ponto de Venda">
      <div className="grid grid-cols-1 gap-6 lg:grid-cols-3">
        {/* Left: Product Search - 2 columns */}
        <div className="lg:col-span-2">
          <ProductSearch onAdd={handleAddToCart} />
        </div>

        {/* Right: Cart - 1 column */}
        <div>
          <div className="sticky top-6">
            <Cart
              items={cart}
              customer={customer}
              onCustomerChange={setCustomer}
              onCheckout={() => setShowPayment(true)}
              onClear={() => setCart([])}
            />
          </div>
        </div>
      </div>

      {/* Payment Modal */}
      {showPayment && (
        <PaymentModal
          cart={cart}
          customer={customer}
          total={cartTotal}
          onClose={() => setShowPayment(false)}
          onComplete={(sale) => {
            toast.success('Venda confirmada!')
            router.visit(`/sales/${sale.id}`)
          }}
        />
      )}
    </AppLayout>
  )
}
```

---

## ðŸ” AutenticaÃ§Ã£o e PermissÃµes

### **Sistema de PermissÃµes (Spatie)**
```php
// Roles
'admin'      â†’ Acesso total
'manager'    â†’ GestÃ£o operacional
'seller'     â†’ Vendas apenas
'warehouse'  â†’ Estoque apenas
'accountant' â†’ Financeiro apenas

// Permissions (formato: module.action)
'customers.view'
'customers.create'
'customers.edit'
'customers.delete'

'inventory.view'
'inventory.create_movement'
'inventory.adjust'
'inventory.physical_inventory'

'sales.view'
'sales.create'
'sales.cancel'
'sales.discount'

'invoicing.view'
'invoicing.generate'
'invoicing.cancel'

'financial.view'
'financial.receivables.manage'
'financial.payables.manage'
'financial.reports'
```

### **Middleware**
```php
// routes/api.php

Route::middleware(['auth:sanctum', 'tenant'])->group(function () {
    
    // Dashboard (todos autenticados)
    Route::get('/dashboard', [DashboardController::class, 'index']);
    
    // Customers (com permissÃ£o)
    Route::middleware('can:customers.view')->group(function () {
        Route::get('/customers', [CustomerController::class, 'index']);
        Route::get('/customers/{id}', [CustomerController::class, 'show']);
    });
    
    Route::middleware('can:customers.create')->group(function () {
        Route::post('/customers', [CustomerController::class, 'store']);
    });
    
    // Inventory (mÃ³dulo ativo + permissÃ£o)
    Route::middleware(['module:inventory'])->group(function () {
        Route::middleware('can:inventory.view')->group(function () {
            Route::get('/inventory/balances', [BalanceController::class, 'index']);
        });
        
        Route::middleware('can:inventory.create_movement')->group(function () {
            Route::post('/inventory/movements', [MovementController::class, 'store']);
        });
    });
    
    // Sales (mÃ³dulo ativo + permissÃ£o)
    Route::middleware(['module:sales'])->group(function () {
        Route::middleware('can:sales.create')->group(function () {
            Route::post('/sales', [SaleController::class, 'store']);
        });
    });
});
```

---

## ðŸ“¡ API e Endpoints

### **AutenticaÃ§Ã£o**
```bash
# Login
POST /api/auth/login
{
  "email": "admin@empresa.com",
  "password": "secret"
}

Response:
{
  "token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "user": { ... },
  "tenant": { ... },
  "modules": ["customers", "inventory", "sales"]
}

# Logout
POST /api/auth/logout
```

### **Principais Endpoints por MÃ³dulo**
```bash
# CUSTOMERS
GET    /api/customers
POST   /api/customers
GET    /api/customers/{id}
PUT    /api/customers/{id}
DELETE /api/customers/{id}

# CATALOG
GET    /api/items
POST   /api/items
GET    /api/items/{id}
PUT    /api/items/{id}
DELETE /api/items/{id}

# INVENTORY
GET    /api/inventory/warehouses
POST   /api/inventory/warehouses
GET    /api/inventory/movements
POST   /api/inventory/movements
GET    /api/inventory/balances
GET    /api/inventory/balances/product/{id}

# SALES
GET    /api/sales
POST   /api/sales
GET    /api/sales/{id}
POST   /api/sales/{id}/confirm
POST   /api/sales/{id}/cancel
POST   /api/sales/{id}/payments

# INVOICING
GET    /api/invoices
POST   /api/invoices
GET    /api/invoices/{id}
GET    /api/invoices/{id}/pdf
POST   /api/invoices/{id}/send-email

# FINANCIAL
GET    /api/financial/receivables
POST   /api/financial/receivables
POST   /api/financial/receivables/{id}/pay
GET    /api/financial/cash-flow
GET    /api/financial/reports/dre
```

---

## ðŸš€ InstalaÃ§Ã£o e ConfiguraÃ§Ã£o

### **Requisitos**

PHP 8.3+
PostgreSQL 16+
Redis 7+
Node.js 20+
Composer 2+
npm ou yarn


### **InstalaÃ§Ã£o**
```bash
# 1. Clone o repositÃ³rio
git clone https://github.com/seu-usuario/kutenga-erp.git
cd kutenga-erp

# 2. Instale dependÃªncias PHP
composer install

# 3. Instale dependÃªncias Node
npm install

# 4. Configure .env
cp .env.example .env
php artisan key:generate

# 5. Configure banco de dados no .env
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=kutenga_erp
DB_USERNAME=postgres
DB_PASSWORD=sua_senha

# 6. Configure Redis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

# 7. Rode migrations (landlord)
php artisan migrate

# 8. Seed de dados iniciais
php artisan db:seed

# 9. Compile assets
npm run build

# 10. Inicie o servidor
php artisan serve

# 11. Queue worker (novo terminal)
php artisan queue:work

# 12. Horizon (monitoramento)
php artisan horizon
```

### **Criar Tenant de DemonstraÃ§Ã£o**
```bash
# Via Artisan
php artisan tenant:create \
  --subdomain=demo \
  --company="Empresa Demo Lda" \
  --nuit=123456789 \
  --email=admin@demo.com \
  --password=secret123

# Acesse:
http://demo.kutenga.test
```

---

## ðŸ§ª Testes

### **Rodar Testes**
```bash
# Todos os testes
php artisan test

# Com coverage
php artisan test --coverage

# Apenas um mÃ³dulo
php artisan test --filter=InventoryTest

# Parallelo (mais rÃ¡pido)
php artisan test --parallel
```

### **Exemplo de Teste**
```php
// tests/Feature/Inventory/MovementTest.php

use function Pest\Laravel\{actingAs, postJson};

it('registers a stock movement successfully', function () {
    $tenant = Tenant::factory()->create();
    
    $tenant->run(function () {
        $user = User::factory()->create();
        $product = Product::factory()->create([
            'controls_inventory' => true
        ]);
        $warehouse = Warehouse::factory()->create();
        
        actingAs($user)
            ->postJson('/api/inventory/movements', [
                'product_id' => $product->id,
                'warehouse_id' => $warehouse->id,
                'type' => 'in',
                'reason' => 'purchase',
                'quantity' => 100,
                'unit_cost' => 50.00,
            ])
            ->assertStatus(201);
        
        // Verifica saldo
        $balance = InventoryBalance::where('product_id', $product->id)
            ->where('warehouse_id', $warehouse->id)
            ->first();
        
        expect($balance->quantity_available)->toBe(100.0);
    });
});
```

---

## ðŸ“¦ Deploy

### **Laravel Forge + DigitalOcean**
```bash
# 1. Criar servidor no Forge
# 2. Configurar domÃ­nio wildcard (*.kutenga.co.mz)
# 3. Conectar repositÃ³rio Git
# 4. Deploy script:

cd /home/forge/kutenga.co.mz
git pull origin main
composer install --no-dev --optimize-autoloader
npm ci && npm run build
php artisan migrate --force
php artisan config:cache
php artisan route:cache
php artisan view:cache
php artisan queue:restart
php artisan horizon:terminate

# 5. Configurar SSL (Let's Encrypt)
# 6. Configurar Queue Worker (Supervisor)
# 7. Configurar Scheduler (Cron)
```

---

## ðŸ—ºï¸ Roadmap

### **Fase 1: MVP (ConcluÃ­da)**
- [x] Arquitetura multi-tenant
- [x] MÃ³dulo Customers
- [x] MÃ³dulo Catalog
- [x] MÃ³dulo Inventory (bÃ¡sico)
- [x] MÃ³dulo Sales (POS bÃ¡sico)

### **Fase 2: Core Features (Em Andamento)**
- [ ] MÃ³dulo Invoicing completo
- [ ] MÃ³dulo Financial completo
- [ ] RelatÃ³rios avanÃ§ados
- [ ] Dashboard interativo
- [ ] NotificaÃ§Ãµes (email/SMS)

### **Fase 3: OtimizaÃ§Ã£o (Q1 2025)**
- [ ] Performance tuning
- [ ] Cache avanÃ§ado
- [ ] Testes E2E
- [ ] DocumentaÃ§Ã£o API
- [ ] Mobile app (beta)

### **Fase 4: ExpansÃ£o (Q2 2025)**
- [ ] IntegraÃ§Ã£o M-Pesa/E-Mola
- [ ] IntegraÃ§Ã£o AT (automÃ¡tica)
- [ ] Multi-moeda
- [ ] Multi-idioma
- [ ] BI e Analytics

---

## ðŸ“„ LicenÃ§a

Proprietary - Â© 2024 KUTENGA ERP

Todos os direitos reservados.

---

## ðŸ‘¥ Equipe

**Desenvolvedor Principal:** [Seu Nome]  
**Email:** contato@kutenga.co.mz  
**Website:** https://kutenga.co.mz  
**WhatsApp:** +258 84 XXX XXXX

---

## ðŸ‡²ðŸ‡¿ Feito em MoÃ§ambique

KUTENGA ERP Ã© desenvolvido em MoÃ§ambique, por moÃ§ambicanos, para empresas moÃ§ambicanas.

> **"Kutenga"** - Do xiChangana, significa "comprar" ou "adquirir". Representa o ato de investir no crescimento do seu negÃ³cio atravÃ©s de tecnologia.

---

**KUTENGA ERP** - GestÃ£o completa para o seu negÃ³cio  
*ConstruÃ­do com â¤ï¸ em MoÃ§ambique usando Laravel e React*